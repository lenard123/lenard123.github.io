/*! For license information please see 633.main.js.LICENSE.txt */
(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[633],{99:(t,e,n)=>{"use strict";n.d(e,{Z:()=>T});var r,i,o=n(655),s=n(589),a=n(909),u=n(594),c=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),h=new s.LL("app","Firebase",c),l="@firebase/app",f="[DEFAULT]",p=((i={})[l]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/app-check"]="fire-app-check",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),d=new u.Yd("@firebase/app"),y=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=(0,s.p$)(t),this.container=new a.H0(e.name),this._addComponent(new a.wA("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){var n;void 0===e&&(e=f),this.checkDestroyed_();var r=this.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=f),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){d.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw h.create("app-deleted",{appName:this.name_})},t}();y.prototype.name&&y.prototype.options||y.prototype.delete||console.log("dc");var v=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=f);var a=o.name;if("string"!=typeof a||!a)throw h.create("bad-app-name",{appName:String(a)});if((0,s.r3)(e,a))throw h.create("duplicate-app",{appName:a});var u=new t(n,o,r);return e[a]=u,u},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=p[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),u=e.match(/\s|\//);if(s||u){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&u&&c.push("and"),u&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void d.warn(c.join(" "))}o(new a.wA(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:u.Ub,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw h.create("invalid-log-argument");(0,u.Am)(t,e)},apps:null,SDK_VERSION:"8.7.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(t=t||f,!(0,s.r3)(e,t))throw h.create("no-app",{appName:t});return e[t]}function o(o){var a=o.name;if(n.has(a))return d.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===o.type?r[a]:null;if(n.set(a,o),"PUBLIC"===o.type){var u=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[a])throw h.create("invalid-app-argument",{appName:a});return t[a]()};void 0!==o.serviceProps&&(0,s.ZB)(u,o.serviceProps),r[a]=u,t.prototype[a]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,a).apply(this,o.multipleInstances?t:[])}}for(var c=0,l=Object.keys(e);c<l.length;c++){var f=l[c];e[f]._addComponent(o)}return"PUBLIC"===o.type?r[a]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(y);return e.INTERNAL=(0,o.pi)((0,o.pi)({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){(0,s.ZB)(e,t)},createSubscribe:s.ne,ErrorFactory:s.LL,deepExtend:s.ZB}),e}(),g=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();if((0,s.jU)()&&void 0!==self.firebase){d.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var m=self.firebase.SDK_VERSION;m&&m.indexOf("LITE")>=0&&d.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var b=v.initializeApp;v.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,s.UG)()&&d.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),b.apply(void 0,t)};var w=v;!function(t,e){t.INTERNAL.registerComponent(new a.wA("platform-logger",(function(t){return new g(t)}),"PRIVATE")),t.registerVersion(l,"0.6.28",void 0),t.registerVersion("fire-js","")}(w);const T=w},909:(t,e,n)=>{"use strict";n.d(e,{wA:()=>o,H0:()=>u});var r=n(655),i=n(589),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),s="[DEFAULT]",a=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Map}return t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.BH;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}try{for(var i=(0,r.XA)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=(0,r.CR)(o.value,2),u=a[0],c=a[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService({instanceIdentifier:h});c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=s),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all((0,r.ev)((0,r.ev)([],(0,r.CR)(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),(0,r.CR)(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=s),this.instances.has(t)},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var i=t.options,o=void 0===i?{}:i,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var u=(0,r.XA)(this.instancesDeferred.entries()),c=u.next();!c.done;c=u.next()){var h=(0,r.CR)(c.value,2),l=h[0],f=h[1];s===this.normalizeInstanceIdentifier(l)&&f.resolve(a)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}return a},t.prototype.onInit=function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&t(o,r),function(){i.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,e){var n,i,o=this.onInitCallbacks.get(e);if(o)try{for(var s=(0,r.XA)(o),a=s.next();!a.done;a=s.next()){var u=a.value;try{u(t,e)}catch(t){}}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===s?void 0:e),options:i}),this.instances.set(n,o),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(t){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=s),this.component?this.component.multipleInstances?t:s:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}(),u=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new a(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()},594:(t,e,n)=>{"use strict";function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var i;n.d(e,{in:()=>o,Yd:()=>l,Ub:()=>f,Am:()=>p});var o,s=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(o||(o={}));var a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},u=o.INFO,c=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),h=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var o=(new Date).toISOString(),s=c[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,r(["["+o+"]  "+t.name+":"],n))}},l=function(){function t(t){this.name=t,this._logLevel=u,this._logHandler=h,this._userLogHandler=null,s.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?a[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],t)),this._logHandler.apply(this,r([this,o.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],t)),this._logHandler.apply(this,r([this,o.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],t)),this._logHandler.apply(this,r([this,o.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],t)),this._logHandler.apply(this,r([this,o.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],t)),this._logHandler.apply(this,r([this,o.ERROR],t))},t}();function f(t){s.forEach((function(e){e.setLogLevel(t)}))}function p(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=a[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:o[n].toLowerCase(),message:a,args:i,type:e.name})}},r=0,i=s;r<i.length;r++)n(i[r])}},589:(t,e,n)=>{"use strict";n.d(e,{BH:()=>a,LL:()=>w,r3:()=>E,Sg:()=>u,ne:()=>_,p$:()=>o,ZB:()=>s,m9:()=>N,z$:()=>c,jU:()=>f,ru:()=>p,d:()=>y,w1:()=>v,uI:()=>h,UG:()=>l,b$:()=>d,G6:()=>m,Mn:()=>g});var r=n(655),i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var h=s<<4&240|a>>2;if(r.push(h),64!==u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function o(t){return s(void 0,t)}function s(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=s(t[n],e[n]));return t}var a=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();function u(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",o=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=(0,r.pi)({iss:"https://securetoken.google.com/"+n,aud:n,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),i.encodeString(JSON.stringify(a),!1),""].join(".")}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function l(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}function f(){return"object"==typeof self&&self.self===self}function p(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function d(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function y(){return c().indexOf("Electron/")>=0}function v(){var t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function g(){return c().indexOf("MSAppHost/")>=0}function m(){return!l()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var b=function(t){function e(n,r,i){var o=t.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,w.prototype.create),o}return(0,r.ZT)(e,t),e}(Error),w=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?T(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new b(i,a,r);return u},t}();function T(t,e){return t.replace(I,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var I=/\{\$([^}]+)}/g;function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e){var n=new S(t,e);return n.subscribe.bind(n)}!function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}();var S=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=A),void 0===r.error&&(r.error=A),void 0===r.complete&&(r.complete=A);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function A(){}function N(t){return t&&t._delegate?t._delegate:t}},503:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r.Z});var r=n(99),i="8.8.0";r.Z.registerVersion("firebase",i,"app"),r.Z.SDK_VERSION=i},517:(t,e,n)=>{"use strict";var r=n(99),i=n(655),o=n(589),s=n(594),a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function u(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var c,h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},l=l||{},f=h||self;function p(){}function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function y(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var v="closure_uid_"+(1e9*Math.random()>>>0),g=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function b(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function w(t,e,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:b).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function E(){this.s=this.s,this.o=this.o}var _={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,v)&&t[v]||(t[v]=++g)}(this);delete _[t]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var S=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},A=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function N(t){return Array.prototype.concat.apply([],arguments)}function D(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function C(t){return/^[\s\xa0]*$/.test(t)}var k,R=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function x(t,e){return-1!=t.indexOf(e)}function O(t,e){return t<e?-1:t>e?1:0}t:{var L=f.navigator;if(L){var P=L.userAgent;if(P){k=P;break t}}k=""}function M(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function F(t){var e={};for(var n in t)e[n]=t[n];return e}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<V.length;o++)n=V[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function q(t){return q[" "](t),t}q[" "]=p;var j,B,G=x(k,"Opera"),K=x(k,"Trident")||x(k,"MSIE"),z=x(k,"Edge"),H=z||K,J=x(k,"Gecko")&&!(x(k.toLowerCase(),"webkit")&&!x(k,"Edge"))&&!(x(k,"Trident")||x(k,"MSIE"))&&!x(k,"Edge"),Q=x(k.toLowerCase(),"webkit")&&!x(k,"Edge");function W(){var t=f.document;return t?t.documentMode:void 0}t:{var Y="",Z=(B=k,J?/rv:([^\);]+)(\)|;)/.exec(B):z?/Edge\/([\d\.]+)/.exec(B):K?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(B):Q?/WebKit\/(\S+)/.exec(B):G?/(?:Version)[ \/]?(\S+)/.exec(B):void 0);if(Z&&(Y=Z?Z[1]:""),K){var X=W();if(null!=X&&X>parseFloat(Y)){j=String(X);break t}}j=Y}var $,tt={};function et(){return t=tt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=R(String(j)).split("."),n=R("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=O(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||O(0==o[2].length,0==s[2].length)||O(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}f.document&&K?$=W()||parseInt(j,10)||void 0:$=void 0;var nt=$,rt=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{f.addEventListener("test",p,e),f.removeEventListener("test",p,e)}catch(t){}return t}();function it(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function ot(t,e){if(it.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(J){t:{try{q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:st[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ot.Z.h.call(this)}}it.prototype.h=function(){this.defaultPrevented=!0},I(ot,it);var st={2:"touch",3:"pen",4:"mouse"};ot.prototype.h=function(){ot.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var at="closure_listenable_"+(1e6*Math.random()|0),ut=0;function ct(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++ut,this.ca=this.fa=!1}function ht(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function lt(t){this.src=t,this.g={},this.h=0}function ft(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=S(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ht(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}lt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=pt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new ct(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var dt="closure_lm_"+(1e6*Math.random()|0),yt={};function vt(t,e,n,r,i){if(r&&r.once)return mt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)vt(t,e[o],n,r,i);return null}return n=St(n),t&&t[at]?t.N(e,n,y(r)?!!r.capture:!!r,i):gt(t,e,n,!1,r,i)}function gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=y(i)?!!i.capture:!!i,a=Et(t);if(a||(t[dt]=a=new lt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=It;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)rt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Tt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function mt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)mt(t,e[o],n,r,i);return null}return n=St(n),t&&t[at]?t.O(e,n,y(r)?!!r.capture:!!r,i):gt(t,e,n,!0,r,i)}function bt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);else r=y(r)?!!r.capture:!!r,n=St(n),t&&t[at]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=pt(o=t.g[e],n,r,i))&&(ht(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Et(t))&&(e=t.g[e.toString()],t=-1,e&&(t=pt(e,n,r,i)),(n=-1<t?e[t]:null)&&wt(n))}function wt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[at])ft(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Tt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(ft(n,t),0==n.h&&(n.src=null,e[dt]=null)):ht(t)}}}function Tt(t){return t in yt?yt[t]:yt[t]="on"+t}function It(t,e){if(t.ca)t=!0;else{e=new ot(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&wt(t),t=n.call(r,e)}return t}function Et(t){return(t=t[dt])instanceof lt?t:null}var _t="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"==typeof t?t:(t[_t]||(t[_t]=function(e){return t.handleEvent(e)}),t[_t])}function At(){E.call(this),this.i=new lt(this),this.P=this,this.I=null}function Nt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new it(e,t);else if(e instanceof it)e.target=e.target||t;else{var i=e;U(e=new it(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Dt(s,r,!0,e)&&i}if(i=Dt(s=e.g=t,r,!0,e)&&i,i=Dt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Dt(s=e.g=n[o],r,!1,e)&&i}function Dt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&ft(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}I(At,E),At.prototype[at]=!0,At.prototype.removeEventListener=function(t,e,n,r){bt(this,t,e,n,r)},At.prototype.M=function(){if(At.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)ht(n[r]);delete e.g[t],e.h--}}this.I=null},At.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},At.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ct=f.JSON.stringify;function kt(){var t=Vt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Rt,xt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Ot.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Ot=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new Lt}),(function(t){return t.reset()})),Lt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Pt(t){f.setTimeout((function(){throw t}),0)}function Mt(t,e){Rt||function(){var t=f.Promise.resolve(void 0);Rt=function(){t.then(Ut)}}(),Ft||(Rt(),Ft=!0),Vt.add(t,e)}var Ft=!1,Vt=new xt;function Ut(){for(var t;t=kt();){try{t.h.call(t.g)}catch(t){Pt(t)}var e=Ot;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ft=!1}function qt(t,e){At.call(this),this.h=t||1,this.g=e||f,this.j=w(this.kb,this),this.l=Date.now()}function jt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Bt(t,e,n){if("function"==typeof t)n&&(t=w(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=w(t.handleEvent,t)}return 2147483647<Number(e)?-1:f.setTimeout(t,e||0)}function Gt(t){t.g=Bt((function(){t.g=null,t.i&&(t.i=!1,Gt(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}I(qt,At),(c=qt.prototype).da=!1,c.S=null,c.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Nt(this,"tick"),this.da&&(jt(this),this.start()))}},c.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},c.M=function(){qt.Z.M.call(this),jt(this),delete this.g};var Kt=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Gt(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(f.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(E);function zt(t){E.call(this),this.h=t,this.g={}}I(zt,E);var Ht=[];function Jt(t,e,n,r){Array.isArray(n)||(n&&(Ht[0]=n.toString()),n=Ht);for(var i=0;i<n.length;i++){var o=vt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Qt(t){M(t.g,(function(t,e){this.g.hasOwnProperty(e)&&wt(t)}),t),t.g={}}function Wt(){this.g=!0}function Yt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ct(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}zt.prototype.M=function(){zt.Z.M.call(this),Qt(this)},zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Wt.prototype.Aa=function(){this.g=!1},Wt.prototype.info=function(){};var Zt={},Xt=null;function $t(){return Xt=Xt||new At}function te(t){it.call(this,Zt.Ma,t)}function ee(t){var e=$t();Nt(e,new te(e,t))}function ne(t,e){it.call(this,Zt.STAT_EVENT,t),this.stat=e}function re(t){var e=$t();Nt(e,new ne(e,t))}function ie(t,e){it.call(this,Zt.Na,t),this.size=e}function oe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return f.setTimeout((function(){t()}),e)}Zt.Ma="serverreachability",I(te,it),Zt.STAT_EVENT="statevent",I(ne,it),Zt.Na="timingevent",I(ie,it);var se={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ae={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ue(){}function ce(t){return t.h||(t.h=t.i())}function he(){}ue.prototype.h=null;var le,fe={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function pe(){it.call(this,"d")}function de(){it.call(this,"c")}function ye(){}function ve(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new zt(this),this.P=me,t=H?125:void 0,this.W=new qt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}I(pe,it),I(de,it),I(ye,ue),ye.prototype.g=function(){return new XMLHttpRequest},ye.prototype.i=function(){return{}},le=new ye;var me=45e3,be={},we={};function Te(t,e,n){t.K=1,t.v=Ke(Ve(e)),t.s=n,t.U=!0,Ie(t,null)}function Ie(t,e){t.F=Date.now(),Ae(t),t.A=Ve(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),rn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ge,t.g=or(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Kt(w(t.Ia,t,t.g),t.O)),Jt(t.V,t.g,"readystatechange",t.gb),e=t.H?F(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),ee(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ee(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function _e(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Se(t,n))==we){4==e&&(t.o=4,re(14),i=!1),Yt(t.j,t.m,null,"[Incomplete Response]");break}if(r==be){t.o=4,re(15),Yt(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Yt(t.j,t.m,r,null),Re(t,r)}Ee(t)&&r!=we&&r!=be&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,re(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Zn(e),e.L=!0,re(11))):(Yt(t.j,t.m,n,"[Invalid Chunked Response]"),ke(t),Ce(t))}function Se(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?we:(n=Number(e.substring(n,r)),isNaN(n)?be:(r+=1)+n>e.length?we:(e=e.substr(r,n),t.C=r+n,e))}function Ae(t){t.Y=Date.now()+t.P,Ne(t,t.P)}function Ne(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=oe(w(t.eb,t),e)}function De(t){t.B&&(f.clearTimeout(t.B),t.B=null)}function Ce(t){0==t.l.G||t.I||tr(t.l,t)}function ke(t){De(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,jt(t.W),Qt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Re(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ln(n.i,t)))if(n.I=t.N,!t.J&&ln(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;$n(n),Bn(n)}Yn(n),re(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=oe(w(n.ab,n),6e3));if(1>=hn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else nr(n,11)}else if((t.J||n.g==t)&&$n(n),!C(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(x(h,"spdy")||x(h,"quic")||x(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(fn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Ge(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var p=t;if((r=n).oa=ir(r,r.H?r.la:null,r.W),p.J){pn(r.i,p);var d=p,y=r.K;y&&d.setTimeout(y),d.B&&(De(d),Ae(d)),r.g=p}else Wn(r);0<n.l.length&&zn(n)}else"stop"!=o[0]&&"close"!=o[0]||nr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nr(n,7):jn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}ee(4)}catch(o){}}function xe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)A(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(d(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Oe(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Oe)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Le(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Pe(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Pe(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Pe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(c=ve.prototype).setTimeout=function(t){this.P=t},c.gb=function(t){t=t.target;var e=this.L;e&&3==Mn(t)?e.l():this.Ia(t)},c.Ia=function(t){try{if(t==this.g)t:{var e=Mn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||H||this.g&&(this.h.h||this.g.ga()||Fn(this.g)))){this.I||4!=e||7==n||ee(8==n||0>=r?3:2),De(this);var i=this.g.ba();this.N=i;e:if(Ee(this)){var o=Fn(this.g);t="";var s=o.length,a=4==Mn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ke(this),Ce(this);var u="";break e}this.h.i=new f.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,re(12),ke(this),Ce(this);break t}Yt(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Re(this,i)}this.U?(_e(this,e,u),H&&this.i&&3==e&&(Jt(this.V,this.W,"tick",this.fb),this.W.start())):(Yt(this.j,this.m,u,null),Re(this,u)),4==e&&ke(this),this.i&&!this.I&&(4==e?tr(this.l,this):(this.i=!1,Ae(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,re(12)):(this.o=0,re(13)),ke(this),Ce(this)}}}catch(e){}},c.fb=function(){if(this.g){var t=Mn(this.g),e=this.g.ga();this.C<e.length&&(De(this),_e(this,t,e),this.i&&4!=t&&Ae(this))}},c.cancel=function(){this.I=!0,ke(this)},c.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(ee(3),re(17)),ke(this),this.o=2,Ce(this)):Ne(this,this.Y-t)},(c=Oe.prototype).R=function(){Le(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},c.T=function(){return Le(this),this.g.concat()},c.get=function(t,e){return Pe(this.h,t)?this.h[t]:e},c.set=function(t,e){Pe(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},c.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Me=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fe(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Fe){this.g=void 0!==e?e:t.g,Ue(this,t.j),this.s=t.s,qe(this,t.i),je(this,t.m),this.l=t.l,e=t.h;var n=new $e;n.i=e.i,e.g&&(n.g=new Oe(e.g),n.h=e.h),Be(this,n),this.o=t.o}else t&&(n=String(t).match(Me))?(this.g=!!e,Ue(this,n[1]||"",!0),this.s=ze(n[2]||""),qe(this,n[3]||"",!0),je(this,n[4]),this.l=ze(n[5]||"",!0),Be(this,n[6]||"",!0),this.o=ze(n[7]||"")):(this.g=!!e,this.h=new $e(null,this.g))}function Ve(t){return new Fe(t)}function Ue(t,e,n){t.j=n?ze(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function qe(t,e,n){t.i=n?ze(e,!0):e}function je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Be(t,e,n){e instanceof $e?(t.h=e,function(t,e){e&&!t.j&&(tn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(en(this,e),rn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=He(e,Ze)),t.h=new $e(e,t.g))}function Ge(t,e,n){t.h.set(e,n)}function Ke(t){return Ge(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function He(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Je(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(He(e,Qe,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(He(e,Qe,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(He(n,"/"==n.charAt(0)?Ye:We,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",He(n,Xe)),t.join("")};var Qe=/[#\/\?@]/g,We=/[#\?:]/g,Ye=/[#\?]/g,Ze=/[#\?@]/g,Xe=/#/g;function $e(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function tn(t){t.g||(t.g=new Oe,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function en(t,e){tn(t),e=on(t,e),Pe(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Pe((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Le(t)))}function nn(t,e){return tn(t),e=on(t,e),Pe(t.g.h,e)}function rn(t,e,n){en(t,e),0<n.length&&(t.i=null,t.g.set(on(t,e),D(n)),t.h+=n.length)}function on(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(c=$e.prototype).add=function(t,e){tn(this),this.i=null,t=on(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},c.forEach=function(t,e){tn(this),this.g.forEach((function(n,r){A(n,(function(n){t.call(e,n,r,this)}),this)}),this)},c.T=function(){tn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},c.R=function(t){tn(this);var e=[];if("string"==typeof t)nn(this,t)&&(e=N(e,this.g.get(on(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=N(e,t[n])}return e},c.set=function(t,e){return tn(this),this.i=null,nn(this,t=on(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},c.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},c.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var sn=function(t,e){this.h=t,this.g=e};function an(t){this.l=t||un,t=f.PerformanceNavigationTiming?0<(t=f.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(f.g&&f.g.Ea&&f.g.Ea()&&f.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var un=10;function cn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function hn(t){return t.h?1:t.g?t.g.size:0}function ln(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function fn(t,e){t.g?t.g.add(e):t.h=e}function pn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function dn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=u(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return D(t.i)}function yn(){}function vn(){this.g=new yn}function gn(t,e,n){var r=n||"";try{xe(t,(function(t,n){var i=t;y(t)&&(i=Ct(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function mn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function bn(t){this.l=t.$b||null,this.j=t.ib||!1}function wn(t,e){At.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Tn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){var t,e;if(this.i=dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=u(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},yn.prototype.stringify=function(t){return f.JSON.stringify(t,void 0)},yn.prototype.parse=function(t){return f.JSON.parse(t,void 0)},I(bn,ue),bn.prototype.g=function(){return new wn(this.l,this.j)},bn.prototype.i=function(t){return function(){return t}}({}),I(wn,At);var Tn=0;function In(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function En(t){t.readyState=4,t.l=null,t.j=null,t.A=null,_n(t)}function _n(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(c=wn.prototype).open=function(t,e){if(this.readyState!=Tn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,_n(this)},c.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||f).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},c.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,En(this)),this.readyState=Tn},c.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,_n(this)),this.g&&(this.readyState=3,_n(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==f.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;In(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},c.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?En(this):_n(this),3==this.readyState&&In(this)}},c.Ua=function(t){this.g&&(this.response=this.responseText=t,En(this))},c.Ta=function(t){this.g&&(this.response=t,En(this))},c.ha=function(){this.g&&En(this)},c.setRequestHeader=function(t,e){this.v.append(t,e)},c.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},c.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(wn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Sn=f.JSON.parse;function An(t){At.call(this),this.headers=new Oe,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Nn,this.K=this.L=!1}I(An,At);var Nn="",Dn=/^https?$/i,Cn=["POST","PUT"];function kn(t){return"content-type"==t.toLowerCase()}function Rn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,xn(t),Ln(t)}function xn(t){t.D||(t.D=!0,Nt(t,"complete"),Nt(t,"error"))}function On(t){if(t.h&&void 0!==l&&(!t.C[1]||4!=Mn(t)||2!=t.ba()))if(t.v&&4==Mn(t))Bt(t.Fa,0,t);else if(Nt(t,"readystatechange"),4==Mn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Me)[1]||null;if(!o&&f.self&&f.self.location){var s=f.self.location.protocol;o=s.substr(0,s.length-1)}i=!Dn.test(o?o.toLowerCase():"")}e=i}if(e)Nt(t,"complete"),Nt(t,"success");else{t.m=6;try{var a=2<Mn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",xn(t)}}finally{Ln(t)}}}function Ln(t,e){if(t.g){Pn(t);var n=t.g,r=t.C[0]?p:null;t.g=null,t.C=null,e||Nt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Pn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(f.clearTimeout(t.A),t.A=null)}function Mn(t){return t.g?t.g.readyState:0}function Fn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Nn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Vn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return M(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ge(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function qn(t){this.za=0,this.l=[],this.h=new Wt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Un("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Un("baseRetryDelayMs",5e3,t),this.$a=Un("retryDelaySeedMs",1e4,t),this.Ya=Un("forwardChannelMaxRetries",2,t),this.ra=Un("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new an(t&&t.concurrentRequestLimit),this.Ca=new vn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function jn(t){if(Gn(t),3==t.G){var e=t.V++,n=Ve(t.F);Ge(n,"SID",t.J),Ge(n,"RID",e),Ge(n,"TYPE","terminate"),Jn(t,n),(e=new ve(t,t.h,e,void 0)).K=2,e.v=Ke(Ve(n)),n=!1,f.navigator&&f.navigator.sendBeacon&&(n=f.navigator.sendBeacon(e.v.toString(),"")),!n&&f.Image&&((new Image).src=e.v,n=!0),n||(e.g=or(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ae(e)}rr(t)}function Bn(t){t.g&&(Zn(t),t.g.cancel(),t.g=null)}function Gn(t){Bn(t),t.u&&(f.clearTimeout(t.u),t.u=null),$n(t),t.i.cancel(),t.m&&("number"==typeof t.m&&f.clearTimeout(t.m),t.m=null)}function Kn(t,e){t.l.push(new sn(t.Za++,e)),3==t.G&&zn(t)}function zn(t){cn(t.i)||t.m||(t.m=!0,Mt(t.Ha,t),t.C=0)}function Hn(t,e){var n;n=e?e.m:t.V++;var r=Ve(t.F);Ge(r,"SID",t.J),Ge(r,"RID",n),Ge(r,"AID",t.U),Jn(t,r),t.o&&t.s&&Vn(r,t.o,t.s),n=new ve(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Qn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),fn(t.i,n),Te(n,r,e)}function Jn(t,e){t.j&&xe({},(function(t,n){Ge(e,n,t)}))}function Qn(t,e,n){n=Math.min(t.l.length,n);var r=t.j?w(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{gn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function Wn(t){t.g||t.u||(t.Y=1,Mt(t.Ga,t),t.A=0)}function Yn(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=oe(w(t.Ga,t),er(t,t.A)),t.A++,0))}function Zn(t){null!=t.B&&(f.clearTimeout(t.B),t.B=null)}function Xn(t){t.g=new ve(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ve(t.oa);Ge(e,"RID","rpc"),Ge(e,"SID",t.J),Ge(e,"CI",t.N?"0":"1"),Ge(e,"AID",t.U),Jn(t,e),Ge(e,"TYPE","xmlhttp"),t.o&&t.s&&Vn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Ke(Ve(e)),n.s=null,n.U=!0,Ie(n,t)}function $n(t){null!=t.v&&(f.clearTimeout(t.v),t.v=null)}function tr(t,e){var n=null;if(t.g==e){$n(t),Zn(t),t.g=null;var r=2}else{if(!ln(t.i,e))return;n=e.D,pn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Nt(r=$t(),new ie(r,n,e,i)),zn(t)}else Wn(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(hn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=oe(w(t.Ha,t,e),er(t,t.C)),t.C++,0)))}(t,e)||2==r&&Yn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function nr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=w(t.jb,t);n||(n=new Fe("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||Ue(n,"https"),Ke(n)),function(t,e){var n=new Wt;if(f.Image){var r=new Image;r.onload=T(mn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=T(mn,n,r,"TestLoadImage: error",!1,e),r.onabort=T(mn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=T(mn,n,r,"TestLoadImage: timeout",!1,e),f.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else re(2);t.G=0,t.j&&t.j.va(e),rr(t),Gn(t)}function rr(t){t.G=0,t.I=-1,t.j&&(0==dn(t.i).length&&0==t.l.length||(t.i.i.length=0,D(t.l),t.l.length=0),t.j.ua())}function ir(t,e,n){var r=function(t){return t instanceof Fe?Ve(t):new Fe(t,void 0)}(n);if(""!=r.i)e&&qe(r,e+"."+r.i),je(r,r.m);else{var i=f.location;r=function(t,e,n,r){var i=new Fe(null,void 0);return t&&Ue(i,t),e&&qe(i,e),n&&je(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&M(t.aa,(function(t,e){Ge(r,e,t)})),e=t.D,n=t.sa,e&&n&&Ge(r,e,n),Ge(r,"VER",t.ma),Jn(t,r),r}function or(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new An(new bn({ib:!0})):new An(t.qa)).L=t.H,e}function sr(){}function ar(){if(K&&!(10<=Number(nt)))throw Error("Environmental error: no available transport.")}function ur(t,e){At.call(this),this.g=new qn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!C(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new lr(this)}function cr(t){pe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function hr(){de.call(this),this.status=1}function lr(t){this.g=t}(c=An.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():le.g(),this.C=this.u?ce(this.u):ce(le),this.g.onreadystatechange=w(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Rn(this,t)}t=n||"";var i=new Oe(this.headers);r&&xe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=kn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=f.FormData&&t instanceof f.FormData,!(0<=S(Cn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Pn(this),0<this.B&&((this.K=function(t){return K&&et()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.pa,this)):this.A=Bt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Rn(this,t)}},c.pa=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Nt(this,"timeout"),this.abort(8))},c.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Nt(this,"complete"),Nt(this,"abort"),Ln(this))},c.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ln(this,!0)),An.Z.M.call(this)},c.Fa=function(){this.s||(this.F||this.v||this.l?On(this):this.cb())},c.cb=function(){On(this)},c.ba=function(){try{return 2<Mn(this)?this.g.status:-1}catch(t){return-1}},c.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},c.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},c.Da=function(){return this.m},c.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(c=qn.prototype).ma=8,c.G=1,c.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},c.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new ve(this,this.h,t,void 0),n=this.s;if(this.P&&(n?U(n=F(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Qn(this,e,r),Ge(i=Ve(this.F),"RID",t),Ge(i,"CVER",22),this.D&&Ge(i,"X-HTTP-Session-Id",this.D),Jn(this,i),this.o&&n&&Vn(i,this.o,n),fn(this.i,e),this.Ra&&Ge(i,"TYPE","init"),this.ja?(Ge(i,"$req",r),Ge(i,"SID","null"),e.$=!0,Te(e,i,null)):Te(e,i,r),this.G=2}}else 3==this.G&&(t?Hn(this,t):0==this.l.length||cn(this.i)||Hn(this))},c.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=oe(w(this.bb,this),t)}},c.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,re(10),Bn(this),Xn(this))},c.ab=function(){null!=this.v&&(this.v=null,Bn(this),Yn(this),re(19))},c.jb=function(t){t?(this.h.info("Successfully pinged google.com"),re(2)):(this.h.info("Failed to ping google.com"),re(1))},(c=sr.prototype).xa=function(){},c.wa=function(){},c.va=function(){},c.ua=function(){},c.Oa=function(){},ar.prototype.g=function(t,e){return new ur(t,e)},I(ur,At),ur.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Mt(w(t.hb,t,e))),re(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=ir(t,null,t.W),zn(t)},ur.prototype.close=function(){jn(this.g)},ur.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Kn(this.g,e)}else this.v?((e={}).__data__=Ct(t),Kn(this.g,e)):Kn(this.g,t)},ur.prototype.M=function(){this.g.j=null,delete this.j,jn(this.g),delete this.g,ur.Z.M.call(this)},I(cr,pe),I(hr,de),I(lr,sr),lr.prototype.xa=function(){Nt(this.g,"a")},lr.prototype.wa=function(t){Nt(this.g,new cr(t))},lr.prototype.va=function(t){Nt(this.g,new hr(t))},lr.prototype.ua=function(){Nt(this.g,"b")},ar.prototype.createWebChannel=ar.prototype.g,ur.prototype.send=ur.prototype.u,ur.prototype.open=ur.prototype.m,ur.prototype.close=ur.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,ae.COMPLETE="complete",he.EventType=fe,fe.OPEN="a",fe.CLOSE="b",fe.ERROR="c",fe.MESSAGE="d",At.prototype.listen=At.prototype.N,An.prototype.listenOnce=An.prototype.O,An.prototype.getLastError=An.prototype.La,An.prototype.getLastErrorCode=An.prototype.Da,An.prototype.getStatus=An.prototype.ba,An.prototype.getResponseJson=An.prototype.Qa,An.prototype.getResponseText=An.prototype.ga,An.prototype.send=An.prototype.ea;var fr=se,pr=ae,dr=Zt,yr=10,vr=11,gr=bn,mr=he,br=An,wr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();wr.o=-1;var Tr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ir=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,i.ZT)(e,t),e}(Error),Er=new s.Yd("@firebase/firestore");function _r(){return Er.logLevel}function Sr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Er.logLevel<=s.in.DEBUG){var r=e.map(Dr);Er.debug.apply(Er,(0,i.ev)(["Firestore (8.8.0): "+t],r))}}function Ar(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Er.logLevel<=s.in.ERROR){var r=e.map(Dr);Er.error.apply(Er,(0,i.ev)(["Firestore (8.8.0): "+t],r))}}function Nr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Er.logLevel<=s.in.WARN){var r=e.map(Dr);Er.warn.apply(Er,(0,i.ev)(["Firestore (8.8.0): "+t],r))}}function Dr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Cr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.0) INTERNAL ASSERTION FAILED: "+t;throw Ar(e),new Error(e)}function kr(t,e){t||Cr()}function Rr(t,e){return t}function xr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Or=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=xr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Lr(t,e){return t<e?-1:t>e?1:0}function Pr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Mr(t){return t+"\0"}var Fr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ir(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ir(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ir(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ir(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Lr(this.nanoseconds,t.nanoseconds):Lr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Vr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Fr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ur(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function qr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function jr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Br=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Cr(),void 0===n?n=t.length-e:n>t.length-e&&Cr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Br),Kr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Kr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Ir(Tr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ir(Tr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ir(Tr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Br),Hr=function(){function t(t){this.fields=t,t.sort(zr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Pr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Jr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Lr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Jr.EMPTY_BYTE_STRING=new Jr("");var Qr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wr(t){if(kr(!!t),"string"==typeof t){var e=0,n=Qr.exec(t);if(kr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Yr(t.seconds),nanos:Yr(t.nanos)}}function Yr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Zr(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function Xr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function $r(t){var e=t.mapValue.fields.__previous_value__;return Xr(e)?$r(e):e}function ti(t){var e=Wr(t.mapValue.fields.__local_write_time__.timestampValue);return new Fr(e.seconds,e.nanos)}function ei(t){return null==t}function ni(t){return 0===t&&1/t==-1/0}function ri(t){return"number"==typeof t&&Number.isInteger(t)&&!ni(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ii=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Gr.fromString(e))},t.fromName=function(e){return new t(Gr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Gr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Gr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Gr(e.slice()))},t}();function oi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xr(t)?4:10:Cr()}function si(t,e){var n=oi(t);if(n!==oi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ti(t).isEqual(ti(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Wr(t.timestampValue),r=Wr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Zr(t.bytesValue).isEqual(Zr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Yr(t.geoPointValue.latitude)===Yr(e.geoPointValue.latitude)&&Yr(t.geoPointValue.longitude)===Yr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Yr(t.integerValue)===Yr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Yr(t.doubleValue),r=Yr(e.doubleValue);return n===r?ni(n)===ni(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Pr(t.arrayValue.values||[],e.arrayValue.values||[],si);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ur(n)!==Ur(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!si(n[i],r[i])))return!1;return!0}(t,e);default:return Cr()}}function ai(t,e){return void 0!==(t.values||[]).find((function(t){return si(t,e)}))}function ui(t,e){var n=oi(t),r=oi(e);if(n!==r)return Lr(n,r);switch(n){case 0:return 0;case 1:return Lr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Yr(t.integerValue||t.doubleValue),r=Yr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ti(t),ti(e));case 5:return Lr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Zr(t),r=Zr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Lr(n[i],r[i]);if(0!==o)return o}return Lr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Lr(Yr(t.latitude),Yr(e.latitude));return 0!==n?n:Lr(Yr(t.longitude),Yr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ui(n[i],r[i]);if(o)return o}return Lr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Lr(r[s],o[s]);if(0!==a)return a;var u=ui(n[r[s]],i[o[s]]);if(0!==u)return u}return Lr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Cr()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Lr(t,e);var n=Wr(t),r=Wr(e),i=Lr(n.seconds,r.seconds);return 0!==i?i:Lr(n.nanos,r.nanos)}function hi(t){return li(t)}function li(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Wr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Zr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ii.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=li(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+li(t.fields[o])}return e+"}"}(t.mapValue):Cr();var e,n}function fi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function pi(t){return!!t&&"integerValue"in t}function di(t){return!!t&&"arrayValue"in t}function yi(t){return!!t&&"nullValue"in t}function vi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function gi(t){return!!t&&"mapValue"in t}function mi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return qr(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=mi(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=mi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var bi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!gi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=mi(e)},t.prototype.setAll=function(t){var e=this,n=zr.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=mi(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());gi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return si(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];gi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){qr(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(mi(this.value))},t}();function wi(t){var e=[];return qr(t.fields,(function(t,n){var r=new zr([t]);if(gi(n)){var i=wi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Hr(e)}var Ti=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Vr.min(),bi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,bi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,bi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=bi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=bi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ii=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Ei(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ii(t,e,n,r,i,o,s)}function _i(t){var e=Rr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+hi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),ei(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Fi(e.startAt)),e.endAt&&(n+="|ub:",n+=Fi(e.endAt)),e.h=n}return e.h}function Si(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ui(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!si(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ji(t.startAt,e.startAt)&&ji(t.endAt,e.endAt)}function Ai(t){return ii.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ni=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,i.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Di(t,n,r):"array-contains"===n?new xi(t,r):"in"===n?new Oi(t,r):"not-in"===n?new Li(t,r):"array-contains-any"===n?new Pi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ci(t,n):new ki(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ui(e,this.value)):null!==e&&oi(this.value)===oi(e)&&this.m(ui(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Cr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Di=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ii.fromName(r.referenceValue),i}return(0,i.ZT)(e,t),e.prototype.matches=function(t){var e=ii.comparator(t.key,this.key);return this.m(e)},e}(Ni),Ci=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ri(0,n),r}return(0,i.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ni),ki=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ri(0,n),r}return(0,i.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ni);function Ri(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ii.fromName(t.referenceValue)}))}var xi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,i.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return di(e)&&ai(e.arrayValue,this.value)},e}(Ni),Oi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,i.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},e}(Ni),Li=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,i.ZT)(e,t),e.prototype.matches=function(t){if(ai(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!ai(this.value.arrayValue,e)},e}(Ni),Pi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,i.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!di(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return ai(e.value.arrayValue,t)}))},e}(Ni),Mi=function(t,e){this.position=t,this.before=e};function Fi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return hi(t)})).join(",")}var Vi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ui(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function qi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ii.comparator(ii.fromName(s.referenceValue),n.key):ui(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ji(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!si(t.position[n],e.position[n]))return!1;return!0}var Bi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Gi(t,e,n,r,i,o,s,a){return new Bi(t,e,n,r,i,o,s,a)}function Ki(t){return new Bi(t)}function zi(t){return!ei(t.limit)&&"F"===t.limitType}function Hi(t){return!ei(t.limit)&&"L"===t.limitType}function Ji(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Qi(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Wi(t){return null!==t.collectionGroup}function Yi(t){var e=Rr(t);if(null===e.p){e.p=[];var n=Qi(e),r=Ji(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Vi(n)),e.p.push(new Vi(zr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Vi(zr.keyField(),u))}}}return e.p}function Zi(t){var e=Rr(t);if(!e.T)if("F"===e.limitType)e.T=Ei(e.path,e.collectionGroup,Yi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Yi(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Vi(o.field,s))}var a=e.endAt?new Mi(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Mi(e.startAt.position,!e.startAt.before):null;e.T=Ei(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Xi(t,e,n){return new Bi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $i(t,e){return Si(Zi(t),Zi(e))&&t.limitType===e.limitType}function to(t){return _i(Zi(t))+"|lt:"+t.limitType}function eo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+hi(e.value);var e})).join(", ")+"]"),ei(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Fi(t.startAt)),t.endAt&&(e+=", endAt: "+Fi(t.endAt)),"Target("+e+")"}(Zi(t))+"; limitType="+t.limitType+")"}function no(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ii.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!qi(t.startAt,Yi(t),e)||t.endAt&&qi(t.endAt,Yi(t),e))}(t,e)}function ro(t){return function(e,n){for(var r=!1,i=0,o=Yi(t);i<o.length;i++){var s=o[i],a=io(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function io(t,e,n){var r=t.field.isKeyField()?ii.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ui(r,i):Cr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Cr()}}function oo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ni(e)?"-0":e}}function so(t){return{integerValue:""+t}}function ao(t,e){return ri(e)?so(e):oo(t,e)}var uo=function(){this._=void 0};function co(t,e,n){return t instanceof fo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof po?yo(t,e):t instanceof vo?go(t,e):function(t,e){var n=lo(t,e),r=bo(n)+bo(t.A);return pi(n)&&pi(t.A)?so(r):oo(t.R,r)}(t,e)}function ho(t,e,n){return t instanceof po?yo(t,e):t instanceof vo?go(t,e):n}function lo(t,e){return t instanceof mo?pi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var fo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e}(uo),po=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,i.ZT)(e,t),e}(uo);function yo(t,e){for(var n=wo(e),r=function(t){n.some((function(e){return si(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var vo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,i.ZT)(e,t),e}(uo);function go(t,e){for(var n=wo(e),r=function(t){n=n.filter((function(e){return!si(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var mo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,i.ZT)(e,t),e}(uo);function bo(t){return Yr(t.integerValue||t.doubleValue)}function wo(t){return di(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var To=function(t,e){this.field=t,this.transform=e},Io=function(t,e){this.version=t,this.transformResults=e},Eo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function _o(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var So=function(){};function Ao(t,e,n){t instanceof Ro?function(t,e,n){var r=t.value.clone(),i=Lo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof xo?function(t,e,n){if(_o(t.precondition,e)){var r=Lo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Oo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function No(t,e,n){t instanceof Ro?function(t,e,n){if(_o(t.precondition,e)){var r=t.value.clone(),i=Po(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ko(e),r).setHasLocalMutations()}}(t,e,n):t instanceof xo?function(t,e,n){if(_o(t.precondition,e)){var r=Po(t.fieldTransforms,n,e),i=e.data;i.setAll(Oo(t)),i.setAll(r),e.convertToFoundDocument(ko(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){_o(t.precondition,e)&&e.convertToNoDocument(Vr.min())}(t,e)}function Do(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=lo(o.transform,s||null);null!=a&&(null==n&&(n=bi.empty()),n.set(o.field,a))}return n||null}function Co(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Pr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof po&&e instanceof po||t instanceof vo&&e instanceof vo?Pr(t.elements,e.elements,si):t instanceof mo&&e instanceof mo?si(t.A,e.A):t instanceof fo&&e instanceof fo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ko(t){return t.isFoundDocument()?t.version:Vr.min()}var Ro=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,i.ZT)(e,t),e}(So),xo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,i.ZT)(e,t),e}(So);function Oo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Lo(t,e,n){var r=new Map;kr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,ho(s,a,n[i]))}return r}function Po(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,co(a,u,e))}return r}var Mo,Fo,Vo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,i.ZT)(e,t),e}(So),Uo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,i.ZT)(e,t),e}(So),qo=function(t){this.count=t};function jo(t){switch(t){case Tr.OK:return Cr();case Tr.CANCELLED:case Tr.UNKNOWN:case Tr.DEADLINE_EXCEEDED:case Tr.RESOURCE_EXHAUSTED:case Tr.INTERNAL:case Tr.UNAVAILABLE:case Tr.UNAUTHENTICATED:return!1;case Tr.INVALID_ARGUMENT:case Tr.NOT_FOUND:case Tr.ALREADY_EXISTS:case Tr.PERMISSION_DENIED:case Tr.FAILED_PRECONDITION:case Tr.ABORTED:case Tr.OUT_OF_RANGE:case Tr.UNIMPLEMENTED:case Tr.DATA_LOSS:return!0;default:return Cr()}}function Bo(t){if(void 0===t)return Ar("GRPC error has no .code"),Tr.UNKNOWN;switch(t){case Mo.OK:return Tr.OK;case Mo.CANCELLED:return Tr.CANCELLED;case Mo.UNKNOWN:return Tr.UNKNOWN;case Mo.DEADLINE_EXCEEDED:return Tr.DEADLINE_EXCEEDED;case Mo.RESOURCE_EXHAUSTED:return Tr.RESOURCE_EXHAUSTED;case Mo.INTERNAL:return Tr.INTERNAL;case Mo.UNAVAILABLE:return Tr.UNAVAILABLE;case Mo.UNAUTHENTICATED:return Tr.UNAUTHENTICATED;case Mo.INVALID_ARGUMENT:return Tr.INVALID_ARGUMENT;case Mo.NOT_FOUND:return Tr.NOT_FOUND;case Mo.ALREADY_EXISTS:return Tr.ALREADY_EXISTS;case Mo.PERMISSION_DENIED:return Tr.PERMISSION_DENIED;case Mo.FAILED_PRECONDITION:return Tr.FAILED_PRECONDITION;case Mo.ABORTED:return Tr.ABORTED;case Mo.OUT_OF_RANGE:return Tr.OUT_OF_RANGE;case Mo.UNIMPLEMENTED:return Tr.UNIMPLEMENTED;case Mo.DATA_LOSS:return Tr.DATA_LOSS;default:return Cr()}}(Fo=Mo||(Mo={}))[Fo.OK=0]="OK",Fo[Fo.CANCELLED=1]="CANCELLED",Fo[Fo.UNKNOWN=2]="UNKNOWN",Fo[Fo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fo[Fo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fo[Fo.NOT_FOUND=5]="NOT_FOUND",Fo[Fo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fo[Fo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fo[Fo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fo[Fo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fo[Fo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fo[Fo.ABORTED=10]="ABORTED",Fo[Fo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fo[Fo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fo[Fo.INTERNAL=13]="INTERNAL",Fo[Fo.UNAVAILABLE=14]="UNAVAILABLE",Fo[Fo.DATA_LOSS=15]="DATA_LOSS";var Go=function(){function t(t,e){this.comparator=t,this.root=e||zo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,zo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,zo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ko(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ko(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ko(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ko(this.root,t,this.comparator,!0)},t}(),Ko=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),zo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Cr();if(this.right.isRed())throw Cr();var t=this.left.check();if(t!==this.right.check())throw Cr();return t+(this.isRed()?0:1)},t}();zo.EMPTY=null,zo.RED=!0,zo.BLACK=!1,zo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Cr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Cr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Cr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Cr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Cr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new zo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ho=function(){function t(t){this.comparator=t,this.data=new Go(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Jo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Jo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Jo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Qo=new Go(ii.comparator);function Wo(){return Qo}var Yo=new Go(ii.comparator);function Zo(){return Yo}var Xo=new Go(ii.comparator);function $o(){return Xo}var ts=new Ho(ii.comparator);function es(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ts,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ns=new Ho(Lr);function rs(){return ns}var is=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,os.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Vr.min(),r,rs(),Wo(),es())},t}(),os=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Jr.EMPTY_BYTE_STRING,n,es(),es(),es())},t}(),ss=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},as=function(t,e){this.targetId=t,this.V=e},us=function(t,e,n,r){void 0===n&&(n=Jr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},cs=function(){function t(){this.S=0,this.D=fs(),this.C=Jr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=es(),e=es(),n=es();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Cr()}})),new os(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=fs()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),hs=function(){function t(t){this.W=t,this.G=new Map,this.H=Wo(),this.J=ls(),this.Y=new Ho(Lr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Cr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ai(i))if(0===n){var o=new ii(i.path);this.tt(e,o,Ti.newNoDocument(o,Vr.min()))}else kr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Ai(o.target)){var s=new ii(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Ti.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=es();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new is(t,n,this.Y,this.H,r);return this.H=Wo(),this.J=ls(),this.Y=new Ho(Lr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new cs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ho(Lr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Sr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new cs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ls(){return new Go(ii.comparator)}function fs(){return new Go(ii.comparator)}var ps={asc:"ASCENDING",desc:"DESCENDING"},ds={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ys=function(t,e){this.databaseId=t,this.I=e};function vs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function gs(t,e){return t.I?e.toBase64():e.toUint8Array()}function ms(t,e){return vs(t,e.toTimestamp())}function bs(t){return kr(!!t),Vr.fromTimestamp(function(t){var e=Wr(t);return new Fr(e.seconds,e.nanos)}(t))}function ws(t,e){return function(t){return new Gr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ts(t){var e=Gr.fromString(t);return kr(zs(e)),e}function Is(t,e){return ws(t.databaseId,e.path)}function Es(t,e){var n=Ts(e);if(n.get(1)!==t.databaseId.projectId)throw new Ir(Tr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ir(Tr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ii(Ns(n))}function _s(t,e){return ws(t.databaseId,e)}function Ss(t){var e=Ts(t);return 4===e.length?Gr.emptyPath():Ns(e)}function As(t){return new Gr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ns(t){return kr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ds(t,e,n){return{name:Is(t,e),fields:n.value.mapValue.fields}}function Cs(t,e,n){var r=Es(t,e.name),i=bs(e.updateTime),o=new bi({mapValue:{fields:e.fields}}),s=Ti.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function ks(t,e){var n;if(e instanceof Ro)n={update:Ds(t,e.key,e.value)};else if(e instanceof Vo)n={delete:Is(t,e.key)};else if(e instanceof xo)n={update:Ds(t,e.key,e.data),updateMask:Ks(e.fieldMask)};else{if(!(e instanceof Uo))return Cr();n={verify:Is(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof fo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof po)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof mo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Cr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ms(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Cr()}(t,e.precondition)),n}function Rs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Eo.updateTime(bs(t.updateTime)):void 0!==t.exists?Eo.exists(t.exists):Eo.none()}(e.currentDocument):Eo.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)kr("REQUEST_TIME"===e.setToServerValue),n=new fo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new po(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new vo(i)}else"increment"in e?n=new mo(t,e.increment):Cr();var o=zr.fromServerFormat(e.fieldPath);return new To(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=Es(t,e.update.name),o=new bi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new Hr(e.map((function(t){return zr.fromServerFormat(t)})))}(e.updateMask);return new xo(i,o,s,n,r)}return new Ro(i,o,n,r)}if(e.delete){var a=Es(t,e.delete);return new Vo(a,n)}if(e.verify){var u=Es(t,e.verify);return new Uo(u,n)}return Cr()}function xs(t,e){return{documents:[_s(t,e.path)]}}function Os(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=_s(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=_s(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(vi(t.value))return{unaryFilter:{field:qs(t.field),op:"IS_NAN"}};if(yi(t.value))return{unaryFilter:{field:qs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(vi(t.value))return{unaryFilter:{field:qs(t.field),op:"IS_NOT_NAN"}};if(yi(t.value))return{unaryFilter:{field:qs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qs(t.field),op:Us(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:qs(t.field),direction:Vs(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||ei(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ms(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ms(e.endAt)),n}function Ls(t){var e=Ss(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){kr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ps(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Vi(js(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return ei(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Fs(n.startAt));var h=null;return n.endAt&&(h=Fs(n.endAt)),Gi(e,i,a,s,u,"F",c,h)}function Ps(t){return t?void 0!==t.unaryFilter?[Gs(t)]:void 0!==t.fieldFilter?[Bs(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Ps(t)})).reduce((function(t,e){return t.concat(e)})):Cr():[]}function Ms(t){return{before:t.before,values:t.position}}function Fs(t){var e=!!t.before,n=t.values||[];return new Mi(n,e)}function Vs(t){return ps[t]}function Us(t){return ds[t]}function qs(t){return{fieldPath:t.canonicalString()}}function js(t){return zr.fromServerFormat(t.fieldPath)}function Bs(t){return Ni.create(js(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Cr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Gs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=js(t.unaryFilter.field);return Ni.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=js(t.unaryFilter.field);return Ni.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=js(t.unaryFilter.field);return Ni.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=js(t.unaryFilter.field);return Ni.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Cr()}}function Ks(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function zs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Hs(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Qs(e)),e=Js(t.get(n),e);return Qs(e)}function Js(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Qs(t){return t+""}function Ws(t){var e=t.length;if(kr(e>=2),2===e)return kr(""===t.charAt(0)&&""===t.charAt(1)),Gr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Cr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Cr()}o=s+2}return new Gr(r)}var Ys=function(t,e){this.seconds=t,this.nanoseconds=e},Zs=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Zs.store="owner",Zs.key="owner";var Xs=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Xs.store="mutationQueues",Xs.keyPath="userId";var $s=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};$s.store="mutations",$s.keyPath="batchId",$s.userMutationsIndex="userMutationsIndex",$s.userMutationsKeyPath=["userId","batchId"];var ta=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Hs(e)]},t.key=function(t,e,n){return[t,Hs(e),n]},t}();ta.store="documentMutations",ta.PLACEHOLDER=new ta;var ea=function(t,e){this.path=t,this.readTime=e},na=function(t,e){this.path=t,this.version=e},ra=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ra.store="remoteDocuments",ra.readTimeIndex="readTimeIndex",ra.readTimeIndexPath="readTime",ra.collectionReadTimeIndex="collectionReadTimeIndex",ra.collectionReadTimeIndexPath=["parentPath","readTime"];var ia=function(t){this.byteSize=t};ia.store="remoteDocumentGlobal",ia.key="remoteDocumentGlobalKey";var oa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};oa.store="targets",oa.keyPath="targetId",oa.queryTargetsIndexName="queryTargetsIndex",oa.queryTargetsKeyPath=["canonicalId","targetId"];var sa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};sa.store="targetDocuments",sa.keyPath=["targetId","path"],sa.documentTargetsIndex="documentTargetsIndex",sa.documentTargetsKeyPath=["path","targetId"];var aa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};aa.key="targetGlobalKey",aa.store="targetGlobal";var ua=function(t,e){this.collectionId=t,this.parent=e};ua.store="collectionParents",ua.keyPath=["collectionId","parent"];var ca=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ca.store="clientMetadata",ca.keyPath="clientId";var ha=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ha.store="bundles",ha.keyPath="bundleId";var la=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};la.store="namedQueries",la.keyPath="name";var fa=(0,i.ev)((0,i.ev)([],(0,i.ev)((0,i.ev)([],(0,i.ev)((0,i.ev)([],(0,i.ev)((0,i.ev)([],[Xs.store,$s.store,ta.store,ra.store,oa.store,Zs.store,aa.store,sa.store]),[ca.store])),[ia.store])),[ua.store])),[ha.store,la.store]),pa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",da=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),ya=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},va=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Cr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),ga=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ya,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new wa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Sa(e.target.error);n.ft.reject(new wa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new wa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Sr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ia(e)},t}(),ma=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,o.z$)())&&Ar("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Sr("SimpleDb","Removing database:",t),Ea(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,o.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.gt=function(){return"undefined"!=typeof process&&"YES"===(null==="MISSING_ENV_VAR"?void 0:"MISSING_ENV_VAR".Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n=this;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Sr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new wa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Ir(Tr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new wa(t,n))},i.onupgradeneeded=function(t){Sr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){Sr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s,a,u,c;return(0,i.Jh)(this,(function(h){switch(h.label){case 0:o="readonly"===e,s=0,a=function(){var e,a,c,h,l;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=i.sent(),e=ga.open(u.db,t,o?"readonly":"readwrite",n),a=r(e).catch((function(t){return e.abort(t),va.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(i.sent(),a),c)];case 4:return h=i.sent(),l="FirebaseError"!==h.name&&s<3,Sr("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ba=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Ea(this.Pt.delete())},t}(),wa=function(t){function e(e,n){var r=this;return(r=t.call(this,Tr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,i.ZT)(e,t),e}(Ir);function Ta(t){return"IndexedDbTransactionError"===t.name}var Ia=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Sr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Sr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ea(n)},t.prototype.add=function(t){return Sr("SimpleDb","ADD",this.store.name,t,t),Ea(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ea(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Sr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return Sr("SimpleDb","DELETE",this.store.name,t),Ea(this.store.delete(t))},t.prototype.count=function(){return Sr("SimpleDb","COUNT",this.store.name),Ea(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){Sr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new va((function(n,r){e.onerror=function(t){var e=Sa(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new va((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ba(i),s=e(i.primaryKey,i.value,o);if(s instanceof va){var a=s.catch((function(t){return o.done(),va.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return va.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ea(t){return new va((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Sa(t.target.error);n(e)}}))}var _a=!1;function Sa(t){var e=ma._t((0,o.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Ir("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return _a||(_a=!0,setTimeout((function(){throw r}),0)),r}}return t}var Aa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,i.ZT)(e,t),e}(da);function Na(t,e){var n=Rr(t);return ma.It(n.Mt,e)}var Da=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Ao(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&No(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&No(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Vr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),es())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Pr(this.mutations,t.mutations,(function(t,e){return Co(t,e)}))&&Pr(this.baseMutations,t.baseMutations,(function(t,e){return Co(t,e)}))},t}(),Ca=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){kr(e.mutations.length===r.length);for(var i=$o(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),ka=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Vr.min()),void 0===o&&(o=Vr.min()),void 0===s&&(s=Jr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ra=function(t){this.Lt=t};function xa(t,e){if(e.document)return Cs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ii.fromSegments(e.noDocument.path),r=Fa(e.noDocument.readTime),i=Ti.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ii.fromSegments(e.unknownDocument.path);return r=Fa(e.unknownDocument.version),Ti.newUnknownDocument(o,r)}return Cr()}function Oa(t,e,n){var r=La(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Is(t,e.key),fields:e.data.value.mapValue.fields,updateTime:vs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ra(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ma(e.version);return s=e.hasCommittedMutations,new ra(null,new ea(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ma(e.version);return new ra(new na(c,h),null,null,!0,r,i)}return Cr()}function La(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Pa(t){var e=new Fr(t[0],t[1]);return Vr.fromTimestamp(e)}function Ma(t){var e=t.toTimestamp();return new Ys(e.seconds,e.nanoseconds)}function Fa(t){var e=new Fr(t.seconds,t.nanoseconds);return Vr.fromTimestamp(e)}function Va(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Rs(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Rs(t.Lt,e)})),a=Fr.fromMillis(e.localWriteTimeMs);return new Da(e.batchId,a,n,s)}function Ua(t){var e,n,r=Fa(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Fa(t.lastLimboFreeSnapshotVersion):Vr.min();return void 0!==t.query.documents?(kr(1===(n=t.query).documents.length),e=Zi(Ki(Ss(n.documents[0])))):e=function(t){return Zi(Ls(t))}(t.query),new ka(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Jr.fromBase64String(t.resumeToken))}function qa(t,e){var n,r=Ma(e.snapshotVersion),i=Ma(e.lastLimboFreeSnapshotVersion);n=Ai(e.target)?xs(t.Lt,e.target):Os(t.Lt,e.target);var o=e.resumeToken.toBase64();return new oa(e.targetId,_i(e.target),r,o,e.sequenceNumber,i,n)}function ja(t){var e=Ls({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Xi(e,e.limit,"L"):e}var Ba=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ga(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Fa(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Ga(t).put({bundleId:(n=e).id,createTime:Ma(bs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ka(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:ja(e.bundledQuery),readTime:Fa(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Ka(t).put(function(t){return{name:t.name,readTime:Ma(bs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ga(t){return Na(t,ha.store)}function Ka(t){return Na(t,la.store)}var za=function(){function t(){this.Bt=new Ha}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),va.resolve()},t.prototype.getCollectionParents=function(t,e){return va.resolve(this.Bt.getEntries(e))},t}(),Ha=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ho(Gr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ho(Gr.comparator)).toArray()},t}(),Ja=function(){function t(){this.qt=new Ha}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Hs(i)};return Qa(t).put(o)}return va.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Mr(e),""],!1,!0);return Qa(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ws(o.parent))}return n}))},t}();function Qa(t){return Na(t,ua.store)}var Wa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ya=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Za(t,e,n){var r=t.store($s.store),i=t.store(ta.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){kr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=ta.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return va.waitFor(o).next((function(){return c}))}function Xa(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Cr();e=t.noDocument}return JSON.stringify(e).length}Ya.DEFAULT_COLLECTION_PERCENTILE=10,Ya.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ya.DEFAULT=new Ya(41943040,Ya.DEFAULT_COLLECTION_PERCENTILE,Ya.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ya.DISABLED=new Ya(-1,0,0);var $a=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return kr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return eu(t).$t({index:$s.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=nu(t),s=eu(t);return s.add({}).next((function(a){kr("number"==typeof a);for(var u=new Da(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return ks(t.Lt,e)})),i=n.mutations.map((function(e){return ks(t.Lt,e)}));return new $s(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Ho((function(t,e){return Lr(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],y=ta.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ta.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),va.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return eu(t).get(e).next((function(t){return t?(kr(t.userId===n.userId),Va(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?va.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return eu(t).$t({index:$s.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(kr(e.batchId>=r),o=Va(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return eu(t).$t({index:$s.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return eu(t).Nt($s.userMutationsIndex,n).next((function(t){return t.map((function(t){return Va(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ta.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return nu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Ws(u);if(a===n.userId&&e.path.isEqual(h))return eu(t).get(c).next((function(t){if(!t)throw Cr();kr(t.userId===n.userId),o.push(Va(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ho(Lr),i=[];return e.forEach((function(e){var o=ta.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=nu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Ws(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),va.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ta.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ho(Lr);return nu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Ws(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(eu(t).get(e).next((function(t){if(null===t)throw Cr();kr(t.userId===n.userId),r.push(Va(n.R,t))})))})),va.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Za(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),va.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return va.resolve();var r=IDBKeyRange.lowerBound(ta.prefixForUser(e.userId)),i=[];return nu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ws(t[1]);i.push(o)}else r.done()})).next((function(){kr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return tu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return ru(t).get(this.userId).next((function(t){return t||new Xs(e.userId,-1,"")}))},t}();function tu(t,e,n){var r=ta.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return nu(t).$t({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function eu(t){return Na(t,$s.store)}function nu(t){return Na(t,ta.store)}function ru(t){return Na(t,Xs.store)}var iu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),ou=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new iu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Vr.fromTimestamp(new Fr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return su(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return kr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return su(t).$t((function(s,a){var u=Ua(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return va.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return su(t).$t((function(t,n){var r=Ua(n);e(r)}))},t.prototype.Xt=function(t){return au(t).get(aa.key).next((function(t){return kr(null!==t),t}))},t.prototype.Zt=function(t,e){return au(t).put(aa.key,e)},t.prototype.te=function(t,e){return su(t).put(qa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=_i(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return su(t).$t({range:r,index:oa.queryTargetsIndexName},(function(t,n,r){var o=Ua(n);Si(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=uu(t);return e.forEach((function(e){var s=Hs(e.path);i.push(o.put(new sa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),va.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=uu(t);return va.forEach(e,(function(e){var o=Hs(e.path);return va.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=uu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=uu(t),i=es();return r.$t({range:n,kt:!0},(function(t,e,n){var r=Ws(t[1]),o=new ii(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Hs(e.path),r=IDBKeyRange.bound([n],[Mr(n)],!1,!0),i=0;return uu(t).$t({index:sa.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return su(t).get(e).next((function(t){return t?Ua(t):null}))},t}();function su(t){return Na(t,oa.store)}function au(t){return Na(t,aa.store)}function uu(t){return Na(t,sa.store)}function cu(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){if(t.code!==Tr.FAILED_PRECONDITION||t.message!==pa)throw t;return Sr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function hu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Lr(n,i);return 0===s?Lr(r,o):s}var lu=function(){function t(t){this.ne=t,this.buffer=new Ho(hu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();hu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),fu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Sr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return(0,i.mG)(e,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Ta(e=n.sent())?(Sr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,cu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),pu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return va.resolve(wr.o);var r=new lu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector","Garbage collection skipped; disabled"),va.resolve(Wa)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Wa):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(Sr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),h.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),_r()<=s.in.DEBUG&&Sr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-l)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),va.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),du=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new pu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return yu(t,n)},t.prototype.removeReference=function(t,e,n){return yu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return yu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return ru(t).Ot((function(r){return tu(t,r,e).next((function(t){return t&&(n=!0),va.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),uu(t).delete([0,Hs(s.path)])}))}));i.push(u)}})).next((function(){return va.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return yu(t,e)},t.prototype.we=function(t,e){var n,r=uu(t),i=wr.o;return r.$t({index:sa.documentTargetsIndex},(function(t,r){var o=t[0];t[1];var s=r.path,a=r.sequenceNumber;0===o?(i!==wr.o&&e(new ii(Ws(n)),i),i=a,n=s):i=wr.o})).next((function(){i!==wr.o&&e(new ii(Ws(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function yu(t,e){return uu(t).put(function(t,e){return new sa(0,Hs(t.path),e)}(e,t.currentSequenceNumber))}var vu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){qr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return jr(this.inner)},t}(),gu=function(){function t(){this.changes=new vu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Vr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Ti.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?va.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),mu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Tu(t).put(Iu(e),n)},t.prototype.removeEntry=function(t,e){var n=Tu(t),r=Iu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Tu(t).get(Iu(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Tu(t).get(Iu(e)).next((function(t){return{document:n.ye(e,t),size:Xa(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Wo();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Wo(),i=new Go(ii.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Xa(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return va.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Tu(t).$t({range:r},(function(t,e,r){for(var s=ii.fromSegments(t);o&&ii.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Wo(),o=e.path.length+1,s={};if(n.isEqual(Vr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=La(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ra.collectionReadTimeIndex}return Tu(t).$t(s,(function(t,n,s){if(t.length===o){var a=xa(r.R,n);e.path.isPrefixOf(a.key.path)?no(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new bu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return wu(t).get(ia.key).next((function(t){return kr(!!t),t}))},t.prototype.me=function(t,e){return wu(t).put(ia.key,e)},t.prototype.ye=function(t,e){if(e){var n=xa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Vr.min()))return n}return Ti.newInvalidDocument(t)},t}(),bu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new vu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return(0,i.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ho((function(t,e){return Lr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Oa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Xa(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Oa(e.Ie.R,Ti.newNoDocument(o,Vr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),va.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(gu);function wu(t){return Na(t,ia.store)}function Tu(t){return Na(t,ra.store)}function Iu(t){return t.path.toArray()}var Eu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;kr(n<r&&n>=0&&r<=11);var o=new ga("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Zs.store)}(t),function(t){t.createObjectStore(Xs.store,{keyPath:Xs.keyPath}),t.createObjectStore($s.store,{keyPath:$s.keyPath,autoIncrement:!0}).createIndex($s.userMutationsIndex,$s.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ta.store)}(t),_u(t),function(t){t.createObjectStore(ra.store)}(t));var s=va.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(sa.store),t.deleteObjectStore(oa.store),t.deleteObjectStore(aa.store)}(t),_u(t)),s=s.next((function(){return function(t){var e=t.store(aa.store),n=new aa(0,0,Vr.min().toTimestamp(),0);return e.put(aa.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store($s.store).Nt().next((function(n){t.deleteObjectStore($s.store),t.createObjectStore($s.store,{keyPath:$s.keyPath,autoIncrement:!0}).createIndex($s.userMutationsIndex,$s.userMutationsKeyPath,{unique:!0});var r=e.store($s.store),i=n.map((function(t){return r.put(t)}));return va.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ca.store,{keyPath:ca.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ia.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ra.store);e.createIndex(ra.readTimeIndex,ra.readTimeIndexPath,{unique:!1}),e.createIndex(ra.collectionReadTimeIndex,ra.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ha.store,{keyPath:ha.keyPath})}(t),function(t){t.createObjectStore(la.store,{keyPath:la.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ra.store).$t((function(t,n){e+=Xa(n)})).next((function(){var n=new ia(e);return t.store(ia.store).put(ia.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Xs.store),r=t.store($s.store);return n.Nt().next((function(n){return va.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt($s.userMutationsIndex,i).next((function(r){return va.forEach(r,(function(r){kr(r.userId===n.userId);var i=Va(e.R,r);return Za(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(sa.store),n=t.store(ra.store);return t.store(aa.store).get(aa.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Gr(n),s=function(t){return[0,Hs(t)]}(o);r.push(e.get(s).next((function(n){return n?va.resolve():function(n){return e.put(new sa(0,Hs(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return va.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ua.store,{keyPath:ua.keyPath});var n=e.store(ua.store),r=new Ha,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Hs(i)})}};return e.store(ra.store).$t({kt:!0},(function(t,e){var n=new Gr(t);return i(n.popLast())})).next((function(){return e.store(ta.store).$t({kt:!0},(function(t,e){t[0];var n=t[1];t[2];var r=Ws(n);return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(oa.store);return n.$t((function(t,r){var i=Ua(r),o=qa(e.R,i);return n.put(o)}))},t}();function _u(t){t.createObjectStore(sa.store,{keyPath:sa.keyPath}).createIndex(sa.documentTargetsIndex,sa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(oa.store,{keyPath:oa.keyPath}).createIndex(oa.queryTargetsIndexName,oa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(aa.store)}var Su="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Au=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Ir(Tr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new du(this,i),this.Le=n+"main",this.R=new Ra(u),this.Be=new ma(this.Le,11,new Eu(this.R)),this.qe=new ou(this.referenceDelegate,this.R),this.Ut=new Ja,this.Ue=function(t,e){return new mu(t,e)}(this.R,this.Ut),this.Ke=new Ba,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Ar("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Ir(Tr.FAILED_PRECONDITION,Su);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new wr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,i.mG)(e,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return(0,i.mG)(e,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return(0,i.mG)(e,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Du(e).put(new ca(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Ta(e))return Sr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Sr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Nu(t).get(Zs.key).next((function(t){return va.resolve(e.tn(t))}))},t.prototype.en=function(t){return Du(t).delete(this.clientId)},t.prototype.nn=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e,n,r,o=this;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Na(t,ca.store);return e.Nt().next((function(t){var n=o.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return va.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)r=n[e],this.Qe.removeItem(this.on(r.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?va.resolve(!0):Nu(t).get(Zs.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Ir(Tr.FAILED_PRECONDITION,Su);return!1}}return!(!e.networkEnabled||!e.inForeground)||Du(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Sr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t=this;return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Zs.store,ca.store],(function(e){var n=new Aa(e,wr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Du(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return $a.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Sr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,fa,(function(o){return i=new Aa(o,r.Ne?r.Ne.next():wr.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Ar("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new Ir(Tr.FAILED_PRECONDITION,pa);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Nu(t).get(Zs.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Ir(Tr.FAILED_PRECONDITION,Su)}))},t.prototype.Ze=function(t){var e=new Zs(this.clientId,this.allowTabSynchronization,Date.now());return Nu(t).put(Zs.key,e)},t.yt=function(){return ma.yt()},t.prototype.Xe=function(t){var e=this,n=Nu(t);return n.get(Zs.key).next((function(t){return e.tn(t)?(Sr("IndexedDbPersistence","Releasing primary lease."),n.delete(Zs.key)):va.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Ar("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),(0,o.G6)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Sr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Ar("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Ar("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Nu(t){return Na(t,Zs.store)}function Du(t){return Na(t,ca.store)}function Cu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var ku=function(t,e){this.progress=t,this.wn=e},Ru=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return ii.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Wi(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new ii(e)).next((function(t){var e=Zo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Zo();return this.Ut.getCollectionParents(t,i).next((function(s){return va.forEach(s,(function(s){var a=function(t,e){return new Bi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Ti.newInvalidDocument(c),r=r.insert(c,h)),No(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){no(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=es(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof xo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),xu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=es(),i=es(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ou=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Vr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var a=i.Cn(e,o);return(zi(e)||Hi(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(_r()<=s.in.DEBUG&&Sr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),eo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Ho(ro(t));return e.forEach((function(e,r){no(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return _r()<=s.in.DEBUG&&Sr("QueryEngine","Using full collection scan to execute query:",eo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Vr.min())},t}(),Lu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Go(Lr),this.kn=new vu((function(t){return _i(t)}),Si),this.$n=Vr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ru(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function Pu(t,e,n,r){return new Lu(t,e,n,r)}function Mu(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=Rr(t),r=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var i;return n._n.getAllMutationBatches(t).next((function(s){return i=s,r=n.persistence.getMutationQueue(e),o=new Ru(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=es(),a=0,u=i;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=e;p<d.length;p++){var y=d[p];r.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return o.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return s=i.sent(),[2,(n._n=r,n.Mn=o,n.xn.Vn(n.Mn),s)]}}))}))}function Fu(t,e){var n=Rr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=va.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);kr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Vu(t){var e=Rr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Uu(t,e){var n=Rr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return kr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Wo();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(qu(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Vr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return va.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function qu(t,e,n,r,i){var o=es();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Wo();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Vr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Sr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function ju(t,e){var n=Rr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Bu(t,e){var n=Rr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,va.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new ka(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Gu(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:r=Rr(t),o=r.Fn.get(e),s=n?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!Ta(a=i.sent()))throw a;return Sr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(o.target),[2]}}))}))}function Ku(t,e,n){var r=Rr(t),i=Vr.min(),o=es();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Rr(t),i=r.kn.get(n);return void 0!==i?va.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Zi(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Vr.min(),n?o:es())})).next((function(t){return{documents:t,Bn:o}}))}))}function zu(t,e){var n=Rr(t),r=Rr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Hu(t){var e=Rr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Rr(t),i=Wo(),o=La(n),s=Tu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ra.readTimeIndex,range:a},(function(t,e){var n=xa(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Pa(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn,r=t.readTime;return e.$n=r,n}))}function Ju(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){return[2,(e=Rr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Tu(t),n=Vr.min();return e.$t({index:ra.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Pa(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function Qu(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s,a,u,c,h,l,f,p,d;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:for(o=Rr(t),s=es(),a=Wo(),u=$o(),c=0,h=n;c<h.length;c++)l=h[c],f=e.qn(l.metadata.name),l.document&&(s=s.add(f)),a=a.insert(f,e.Un(l)),u=u.insert(f,e.Kn(l.metadata.readTime));return p=o.On.newChangeBuffer({trackRemovals:!0}),[4,Bu(o,function(t){return Zi(Ki(Gr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=i.sent(),[2,o.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return qu(t,p,a,Vr.min(),u).next((function(e){return p.apply(t),e})).next((function(e){return o.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return o.qe.addMatchingKeys(t,s,d.targetId)})).next((function(){return o.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Wu(t,e,n){return void 0===n&&(n=es()),(0,i.mG)(this,void 0,void 0,(function(){var r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,Bu(t,Zi(ja(e.bundledQuery)))];case 1:return r=i.sent(),[2,(o=Rr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var i=bs(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return o.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Jr.EMPTY_BYTE_STRING,i);return o.Fn=o.Fn.insert(s.targetId,s),o.qe.updateTargetData(t,s).next((function(){return o.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return o.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return o.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var Yu=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return va.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:bs(n.createTime)}),va.resolve()},t.prototype.getNamedQuery=function(t,e){return va.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:ja(t.bundledQuery),readTime:bs(t.readTime)}}(e)),va.resolve()},t}(),Zu=function(){function t(){this.Wn=new Ho(Xu.Gn),this.zn=new Ho(Xu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Xu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Xu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new ii(new Gr([])),r=new Xu(n,t),i=new Xu(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ii(new Gr([])),n=new Xu(e,t),r=new Xu(e,t+1),i=es();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Xu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Xu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ii.comparator(t.key,e.key)||Lr(t.ns,e.ns)},t.Hn=function(t,e){return Lr(t.ns,e.ns)||ii.comparator(t.key,e.key)},t}(),$u=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ho(Xu.Gn)}return t.prototype.checkEmpty=function(t){return va.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Da(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Xu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return va.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return va.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return va.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return va.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return va.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Xu(e,0),i=new Xu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),va.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ho(Lr);return e.forEach((function(t){var e=new Xu(t,0),i=new Xu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),va.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ii.isDocumentKey(i)||(i=i.child(""));var o=new Xu(new ii(i),0),s=new Ho(Lr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),va.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;kr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return va.forEach(e.mutations,(function(i){var o=new Xu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Xu(e,0),r=this.rs.firstAfterOrEqual(n);return va.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,va.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),tc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Go(ii.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return va.resolve(n?n.document.clone():Ti.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Wo();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Ti.newInvalidDocument(t))})),va.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Wo(),i=new ii(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||no(e,c)&&(r=r.insert(c.key,c.clone()))}return va.resolve(r)},t.prototype.fs=function(t,e){return va.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new ec(this)},t.prototype.getSize=function(t){return va.resolve(this.size)},t}(),ec=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,i.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),va.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(gu),nc=function(){function t(t){this.persistence=t,this.ds=new vu((function(t){return _i(t)}),Si),this.lastRemoteSnapshotVersion=Vr.min(),this.highestTargetId=0,this.ws=0,this._s=new Zu,this.targetCount=0,this.ys=iu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),va.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return va.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return va.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),va.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),va.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new iu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,va.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),va.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,va.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),va.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return va.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return va.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),va.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),va.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),va.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return va.resolve(n)},t.prototype.containsKey=function(t,e){return va.resolve(this._s.containsKey(e))},t}(),rc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new wr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new nc(this),this.Ut=new za,this.Ue=function(t,e){return new tc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Ra(e),this.Ke=new Yu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new $u(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Sr("MemoryPersistence","Starting transaction:",t);var i=new ic(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return va.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,i.ZT)(e,t),e}(da),oc=function(){function t(t){this.persistence=t,this.As=new Zu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Cr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),va.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),va.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),va.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return va.forEach(this.vs,(function(r){var i=ii.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return va.or([function(){return va.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),sc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function ac(t,e){return"firestore_clients_"+t+"_"+e}function uc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function cc(t,e){return"firestore_targets_"+t+"_"+e}sc.UNAUTHENTICATED=new sc(null),sc.GOOGLE_CREDENTIALS=new sc("google-credentials-uid"),sc.FIRST_PARTY=new sc("first-party-uid");var hc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Ir(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Ar("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),lc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Ir(i.error.code,i.error.message)),o?new t(e,i.state,r):(Ar("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),fc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=rs(),s=0;i&&s<r.activeTargetIds.length;++s)i=ri(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Ar("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),pc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Ar("SharedClientState","Failed to parse online state: "+e),null)},t}(),dc=function(){function t(){this.activeTargetIds=rs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),yc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Go(Lr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=ac(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new dc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c,h,l,f=this;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(o=this.getItem(ac(this.persistenceKey,r)))&&(s=fc.Vs(r,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)l=h[c],this.Fs(l);return this.$s=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(cc(this.persistenceKey,t));if(n){var r=lc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(cc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Sr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Sr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Sr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Sr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Ar("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return(0,i.mG)(e,void 0,void 0,(function(){var t,e,r,o,s,a;return(0,i.Jh)(this,(function(i){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(o=this.ri(n.key,n.newValue)))return[2,this.oi(o)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=wr.o;if(null!=t)try{var n=JSON.parse(t);kr("number"==typeof n),e=n}catch(t){Ar("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==wr.o&&this.sequenceNumberHandler(a);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new hc(this.currentUser,t,e,n),i=uc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=uc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=cc(this.persistenceKey,t),i=new lc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return fc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return hc.Vs(new sc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return lc.Vs(r,e)},t.prototype.js=function(t){return pc.Vs(t)},t.prototype.ii=function(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Sr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=rs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),vc=function(){function t(){this.li=new dc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new dc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),gc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),mc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),bc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},wc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Tc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,i.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new br;s.listenOnce(pr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case fr.NO_ERROR:var e=s.getResponseJson();Sr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case fr.TIMEOUT:Sr("Connection",'RPC "'+t+'" timed out'),o(new Ir(Tr.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:var n=s.getStatus();if(Sr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Tr).indexOf(e)>=0?e:Tr.UNKNOWN}(r.status);o(new Ir(a,r.message))}else o(new Ir(Tr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ir(Tr.UNAVAILABLE,"Connection failed."));break;default:Cr()}}finally{Sr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new ar,i=$t(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new gr({})),this.Fi(s.initMessageHeaders,e),(0,o.uI)()||(0,o.b$)()||(0,o.d)()||(0,o.w1)()||(0,o.Mn)()||(0,o.ru)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");Sr("Connection","Creating WebChannel: "+a,s);var u=r.createWebChannel(a,s),c=!1,h=!1,l=new wc({Ei:function(t){h?Sr("Connection","Not sending because WebChannel is closed:",t):(c||(Sr("Connection","Opening WebChannel transport."),u.open(),c=!0),Sr("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,mr.EventType.OPEN,(function(){h||Sr("Connection","WebChannel transport opened.")})),f(u,mr.EventType.CLOSE,(function(){h||(h=!0,Sr("Connection","WebChannel transport closed"),l.Vi())})),f(u,mr.EventType.ERROR,(function(t){h||(h=!0,Nr("Connection","WebChannel transport errored:",t),l.Vi(new Ir(Tr.UNAVAILABLE,"The operation could not be completed")))})),f(u,mr.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];kr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Sr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Mo[t];if(void 0!==e)return Bo(e)}(o),a=i.message;void 0===s&&(s=Tr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new Ir(s,a)),u.close()}else Sr("Connection","WebChannel received:",n),l.Si(n)}})),f(i,dr.STAT_EVENT,(function(t){t.stat===yr?Sr("Connection","Detected buffering proxy"):t.stat===vr&&Sr("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Sr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return Sr("RestConnection","Received: ",t),t}),(function(e){throw Nr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=bc[t];return this.Di+"/v1/"+e+":"+n},t}());function Ic(){return"undefined"!=typeof window?window:null}function Ec(){return"undefined"!=typeof document?document:null}function _c(t){return new ys(t,!0)}var Sc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Sr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Ac=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Sc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Tr.RESOURCE_EXHAUSTED?(Ar(e.toString()),Ar("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Tr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Ir(Tr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return Sr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Nc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,i.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Cr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(kr(void 0===e||"string"==typeof e),Jr.fromBase64String(e||"")):(kr(void 0===e||e instanceof Uint8Array),Jr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Tr.UNKNOWN:Bo(t.code);return new Ir(e,t.message||"")}(a);n=new us(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=Es(t,r.document.name),o=bs(r.document.updateTime);var a=new bi({mapValue:{fields:r.document.fields}}),u=(s=Ti.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new ss(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=Es(t,r.document),o=r.readTime?bs(r.readTime):Vr.min(),a=Ti.newNoDocument(i,o),s=r.removedTargetIds||[],n=new ss([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=Es(t,r.document),o=r.removedTargetIds||[],n=new ss([],o,i,null);else{if(!("filter"in e))return Cr();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new qo(r),o=h.targetId,n=new as(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Vr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Vr.min():e.readTime?bs(e.readTime):Vr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=As(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ai(r)?{documents:xs(t,r)}:{query:Os(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=gs(t,e.resumeToken):e.snapshotVersion.compareTo(Vr.min())>0&&(n.readTime=vs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Cr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=As(this.R),e.removeTarget=t,this.cr(e)},e}(Ac),Dc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(kr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(kr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?bs(t.updateTime):bs(e);return n.isEqual(Vr.min())&&(n=bs(e)),new Io(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=bs(t.commitTime);return this.listener.Tr(n,e)}return kr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=As(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return ks(e.R,t)}))};this.cr(n)},e}(Ac),Cc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,i.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new Ir(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Tr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ir(Tr.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Tr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ir(Tr.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),kc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Ar(e),this.Vr=!1):Sr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Rc=function(t,e,n,r,o){var s=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di((function(t){n.enqueueAndForget((function(){return(0,i.mG)(s,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return qc(this)?(Sr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return(e=Rr(t)).Or.add(4),[4,Oc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,xc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new kc(n,r)};function xc(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:if(!qc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Oc(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Lc(t,e){var n=Rr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Uc(n)?Vc(n):eh(n).er()&&Mc(n,e))}function Pc(t,e){var n=Rr(t),r=eh(n);n.$r.delete(e),r.er()&&Fc(n,e),0===n.$r.size&&(r.er()?r.ir():qc(n)&&n.Br.set("Unknown"))}function Mc(t,e){t.qr.U(e.targetId),eh(t).mr(e)}function Fc(t,e){t.qr.U(e),eh(t).yr(e)}function Vc(t){t.qr=new hs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),eh(t).start(),t.Br.Sr()}function Uc(t){return qc(t)&&!eh(t).tr()&&t.$r.size>0}function qc(t){return 0===Rr(t).Or.size}function jc(t){t.qr=void 0}function Bc(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){return t.$r.forEach((function(e,n){Mc(t,e)})),[2]}))}))}function Gc(t,e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){return jc(t),Uc(t)?(t.Br.Nr(e),Vc(t)):t.Br.set("Unknown"),[2]}))}))}function Kc(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s;return(0,i.Jh)(this,(function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof us&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?(s=o[r],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:i.sent(),t.$r.delete(s),t.qr.removeTarget(s),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),Sr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,zc(t,r)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof ss?t.qr.X(e):e instanceof as?t.qr.rt(e):t.qr.et(e),n.isEqual(Vr.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,Vu(t.localStore)];case 8:return o=a.sent(),n.compareTo(o)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Jr.EMPTY_BYTE_STRING,n.snapshotVersion)),Fc(t,e);var r=new ka(n.target,e,1,n.sequenceNumber);Mc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return Sr("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,zc(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}}))}))}function zc(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r=this;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:if(!Ta(e))throw e;return t.Or.add(1),[4,Oc(t)];case 1:return o.sent(),t.Br.set("Offline"),n||(n=function(){return Vu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return(0,i.mG)(r,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return Sr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,xc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Hc(t,e){return e().catch((function(n){return zc(t,n,e)}))}function Jc(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n,r,o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:e=Rr(t),n=nh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,i.label=1;case 1:if(!function(t){return qc(t)&&t.kr.length<10}(e))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,ju(e.localStore,r)];case 3:return null===(o=i.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=o.batchId,function(t,e){t.kr.push(e);var n=nh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=i.sent(),[4,zc(e,s)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return Qc(e)&&Wc(e),[2]}}))}))}function Qc(t){return qc(t)&&!nh(t).tr()&&t.kr.length>0}function Wc(t){nh(t).start()}function Yc(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){return nh(t).Ar(),[2]}))}))}function Zc(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n,r,o;return(0,i.Jh)(this,(function(i){for(e=nh(t),n=0,r=t.kr;n<r.length;n++)o=r[n],e.Er(o.mutations);return[2]}))}))}function Xc(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r=t.kr.shift(),o=Ca.from(r,e,n),[4,Hc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return i.sent(),[4,Jc(t)];case 2:return i.sent(),[2]}}))}))}function $c(t,e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e&&nh(t).pr?[4,function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return jo(r=e.code)&&r!==Tr.ABORTED?(n=t.kr.shift(),nh(t).sr(),[4,Hc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Jc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Qc(t)&&Wc(t),[2]}}))}))}function th(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return n=Rr(t),e?(n.Or.delete(2),[4,xc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Oc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function eh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Rr(t);return r.br(),new Nc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Bc.bind(null,t),Ri:Gc.bind(null,t),_r:Kc.bind(null,t)}),t.Mr.push((function(n){return(0,i.mG)(e,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Uc(t)?Vc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),jc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function nh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Rr(t);return r.br(),new Dc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Yc.bind(null,t),Ri:$c.bind(null,t),Ir:Zc.bind(null,t),Tr:Xc.bind(null,t)}),t.Mr.push((function(n){return(0,i.mG)(e,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Jc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Sr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var rh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ya,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ir(Tr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function ih(t,e){if(Ar("AsyncQueue",e+": "+t),Ta(t))return new Ir(Tr.UNAVAILABLE,e+": "+t);throw t}var oh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ii.comparator(e.key,n.key)}:function(t,e){return ii.comparator(t.key,e.key)},this.keyedMap=Zo(),this.sortedSet=new Go(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),sh=function(){function t(){this.Qr=new Go(ii.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Cr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),ah=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,oh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$i(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),uh=function(){this.Wr=void 0,this.listeners=[]},ch=function(){this.queries=new vu((function(t){return to(t)}),$i),this.onlineState="Unknown",this.Gr=new Set};function hh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u,c;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:if(n=Rr(t),r=e.query,o=!1,(s=n.queries.get(r))||(o=!0,s=new uh),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Wr=i.sent(),[3,4];case 3:return u=i.sent(),c=ih(u,"Initialization of query '"+eo(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&dh(n),[2]}}))}))}function lh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a;return(0,i.Jh)(this,(function(i){return n=Rr(t),r=e.query,o=!1,(s=n.queries.get(r))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function fh(t,e){for(var n=Rr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&dh(n)}function ph(t,e,n){var r=Rr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function dh(t){t.Gr.forEach((function(t){t.next()}))}var yh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ah(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=ah.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),vh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),gh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Es(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Cs(this.R,t.document,!1):Ti.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return bs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new gh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||es()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e,n,r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,Qu(this.localStore,new gh(this.R),this.documents,this.ro.id)];case 1:t=i.sent(),e=this.co(this.documents),n=0,r=this.queries,i.label=2;case 2:return n<r.length?(o=r[n],[4,Wu(this.localStore,o,e.get(o.name))]):[3,5];case 3:i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new ku(Object.assign({},this.progress),t))]}}))}))}}();var mh=function(t){this.key=t},bh=function(t){this.key=t},wh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=es(),this.mutatedKeys=es(),this.lo=ro(t),this.fo=new oh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new sh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=zi(this.query)&&i.size===this.query.limit?i.last():null,c=Hi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=no(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data.isEqual(l.data)?f!==p&&(r.track({type:3,doc:l}),d=!0):n.yo(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),zi(this.query)||Hi(this.query))for(;s.size>this.query.limit;){var h=zi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Cr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new ah(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new sh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=es(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new bh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new mh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=es();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return ah.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Th=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ih=function(t){this.key=t,this.bo=!1},Eh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new vu((function(t){return to(t)}),$i),this.Vo=new Map,this.So=new Set,this.Do=new Go(ii.comparator),this.Co=new Map,this.No=new Zu,this.xo={},this.Fo=new Map,this.ko=iu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function _h(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=$h(t),(s=n.Po.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,Bu(n.localStore,Zi(e))];case 2:return a=i.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,Sh(n,e,r,"current"===u)];case 3:o=i.sent(),n.isPrimaryClient&&Lc(n.remoteStore,a),i.label=4;case 4:return[2,o]}}))}))}function Sh(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s,a,u,c,h;return(0,i.Jh)(this,(function(l){switch(l.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(o=e.view._o(n)).Nn?[4,Ku(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,o)}))]:[3,2];case 1:o=i.sent(),i.label=2;case 2:return s=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(o,t.isPrimaryClient,s),[2,(Vh(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,r)},[4,Ku(t.localStore,e,!0)];case 1:return o=l.sent(),s=new wh(e,o.Bn),a=s._o(o.documents),u=os.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),Vh(t,n,c.To),h=new Th(e,n,s),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}}))}))}function Ah(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=Rr(t),r=n.Po.get(e),(o=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,o.filter((function(t){return!$i(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Gu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Pc(n.remoteStore,r.targetId),Mh(n,r.targetId)})).catch(cu)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return Mh(n,r.targetId),[4,Gu(n.localStore,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))}function Nh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:r=tl(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,function(t,e){var n,r=Rr(t),i=Fr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),es());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Do(c,n.get(c.key));null!=h&&s.push(new xo(c.key,h,wi(h.value.mapValue),Eo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return o=i.sent(),r.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Go(Lr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,o.batchId,n),[4,jh(r,o.changes)];case 3:return i.sent(),[4,Jc(r.remoteStore)];case 4:return i.sent(),[3,6];case 5:return s=i.sent(),a=ih(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}}))}))}function Dh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:n=Rr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Uu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(kr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?kr(r.bo):t.removedDocuments.size>0&&(kr(r.bo),r.bo=!1))})),[4,jh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,cu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Ch(t,e,n){var r=Rr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Rr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&dh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function kh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a,u,c;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(r=Rr(t)).sharedClientState.updateQueryState(e,"rejected",n),o=r.Co.get(e),(s=o&&o.key)?(a=(a=new Go(ii.comparator)).insert(s,Ti.newNoDocument(s,Vr.min())),u=es().add(s),c=new is(Vr.min(),new Map,new Ho(Lr),a,u),[4,Dh(r,c)]):[3,2];case 1:return i.sent(),r.Do=r.Do.remove(s),r.Co.delete(e),qh(r),[3,4];case 2:return[4,Gu(r.localStore,e,!1).then((function(){return Mh(r,e,n)})).catch(cu)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}function Rh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:n=Rr(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Fu(n.localStore,e)];case 2:return o=i.sent(),Ph(n,r,null),Lh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,jh(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,cu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function xh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:r=Rr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,function(t,e){var n=Rr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return kr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return o=i.sent(),Ph(r,e,n),Lh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,jh(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,cu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Oh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:qc((n=Rr(t)).remoteStore)||Sr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,function(t){var e=Rr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Fo.get(r)||[]).push(e),n.Fo.set(r,o),[3,4]);case 3:return s=i.sent(),a=ih(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}}))}))}function Lh(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Ph(t,e,n){var r=Rr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Mh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Fh(t,e)}))}function Fh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Pc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),qh(t))}function Vh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof mh?(t.No.addReference(o.key,e),Uh(t,o)):o instanceof bh?(Sr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Fh(t,o.key)):Cr()}}function Uh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Sr("SyncEngine","New document in limbo: "+n),t.So.add(r),qh(t))}function qh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ii(Gr.fromString(e)),r=t.ko.next();t.Co.set(r,new Ih(n)),t.Do=t.Do.insert(n,r),Lc(t.remoteStore,new ka(Zi(Ki(n.path)),r,2,wr.o))}}function jh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a;return(0,i.Jh)(this,(function(u){switch(u.label){case 0:return r=Rr(t),o=[],s=[],a=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,i){a.push(r.Oo(i,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(i.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=xu.Pn(i.targetId,t);s.push(e)}})))})),[4,Promise.all(a)]);case 1:return u.sent(),r.vo._r(o),[4,function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:n=Rr(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return va.forEach(e,(function(e){return va.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return va.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return i.sent(),[3,4];case 3:if(!Ta(r=i.sent()))throw r;return Sr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(u,l));return[2]}}))}))}(r.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))}function Bh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(n=Rr(t)).currentUser.isEqual(e)?[3,3]:(Sr("SyncEngine","User change. New user:",e.toKey()),[4,Mu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new Ir(Tr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,jh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Gh(t,e){var n=Rr(t),r=n.Co.get(e);if(r&&r.bo)return es().add(r.key);var i=es(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Kh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,Ku((n=Rr(t)).localStore,e.query,!0)];case 1:return r=i.sent(),o=e.view.Ao(r),[2,(n.isPrimaryClient&&Vh(n,e.targetId,o.To),o)]}}))}))}function zh(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){return[2,Hu((e=Rr(t)).localStore).then((function(t){return jh(e,t)}))]}))}))}function Hh(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,function(t,e){var n=Rr(t),r=Rr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):va.resolve(null)}))}))}((o=Rr(t)).localStore,e)];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,Jc(o.remoteStore)];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ph(o,e,r||null),Lh(o,e),function(t,e){Rr(Rr(t)._n).Gt(e)}(o.localStore,e)):Cr(),i.label=4;case 4:return[4,jh(o,s)];case 5:return i.sent(),[3,7];case 6:Sr("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}}))}))}function Jh(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return $h(n=Rr(t)),tl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Qh(n,r.toArray())]);case 1:return o=i.sent(),n.$o=!0,[4,th(n.remoteStore,!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)u=a[s],Lc(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Mh(n,e),Gu(n.localStore,e,!0)})),Pc(n.remoteStore,e)})),[4,h]);case 4:return i.sent(),[4,Qh(n,c)];case 5:return i.sent(),function(t){var e=Rr(t);e.Co.forEach((function(t,n){Pc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Go(ii.comparator)}(n),n.$o=!1,[4,th(n.remoteStore,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}}))}))}function Qh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l,f,p,d,y,v;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:n=Rr(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,Bu(n.localStore,Zi(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),l=0,f=h,i.label=3;case 3:return l<f.length?(p=f[l],d=n.Po.get(p),[4,Kh(n,d)]):[3,6];case 4:(y=i.sent()).snapshot&&o.push(y.snapshot),i.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,zu(n.localStore,u)];case 8:return v=i.sent(),[4,Bu(n.localStore,v)];case 9:return c=i.sent(),[4,Sh(n,Wh(v),u,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),r)]}}))}))}function Wh(t){return Gi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Yh(t){var e=Rr(t);return Rr(Rr(e.localStore).persistence).fn()}function Zh(t,e,n,r){return(0,i.mG)(this,void 0,void 0,(function(){var o,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(o=Rr(t)).$o?(Sr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Hu(o.localStore)];case 3:return s=i.sent(),a=is.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,jh(o,s,a)];case 4:return i.sent(),[3,8];case 5:return[4,Gu(o.localStore,e,!0)];case 6:return i.sent(),Mh(o,e,r),[3,8];case 7:Cr(),i.label=8;case 8:return[2]}}))}))}function Xh(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a,u,c,h,l,f,p;return(0,i.Jh)(this,(function(d){switch(d.label){case 0:if(!(r=$h(t)).$o)return[3,10];o=0,s=e,d.label=1;case 1:return o<s.length?(a=s[o],r.Vo.has(a)?(Sr("SyncEngine","Adding an already active target "+a),[3,5]):[4,zu(r.localStore,a)]):[3,6];case 2:return u=d.sent(),[4,Bu(r.localStore,u)];case 3:return c=d.sent(),[4,Sh(r,Wh(u),c.targetId,!1)];case 4:d.sent(),Lc(r.remoteStore,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Gu(r.localStore,t,!1).then((function(){Pc(r.remoteStore,t),Mh(r,t)})).catch(cu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,d.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function $h(t){var e=Rr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Dh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kh.bind(null,e),e.vo._r=fh.bind(null,e.eventManager),e.vo.Mo=ph.bind(null,e.eventManager),e}function tl(t){var e=Rr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xh.bind(null,e),e}var el=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return this.R=_c(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Pu(this.persistence,new Ou,t.initialUser,this.R)},t.prototype.qo=function(t){return new rc(oc.bs,this.R)},t.prototype.Bo=function(t){return new vc},t.prototype.terminate=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),nl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,i.ZT)(e,t),e.prototype.initialize=function(e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Ju(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,tl(this.Qo.syncEngine)];case 4:return n.sent(),[4,Jc(this.Qo.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Ko=function(t){return Pu(this.persistence,new Ou,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new fu(e,t.asyncQueue)},e.prototype.qo=function(t){var e=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ya.withCacheSize(this.cacheSizeBytes):Ya.DEFAULT;return new Au(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Ic(),Ec(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new vc},e}(el),rl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,i.ZT)(e,t),e.prototype.initialize=function(e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r=this;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof yc?(this.sharedClientState.syncEngine={ui:Hh.bind(null,n),ai:Zh.bind(null,n),hi:Xh.bind(null,n),fn:Yh.bind(null,n),ci:zh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He((function(t){return(0,i.mG)(r,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,Jh(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return o.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=Ic();if(!yc.yt(e))throw new Ir(Tr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new yc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(nl),il=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n=this;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ch(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Bh.bind(null,this.syncEngine),[4,th(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new ch},t.prototype.createDatastore=function(t){var e,n=_c(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new Tc(e));return function(t,e,n){return new Cc(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Ch(s.syncEngine,t,0)},o=mc.yt()?new mc:new gc,new Rc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Eh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e=Rr(t),Sr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Oc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),ol=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),sl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ya,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e,n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new vh(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n=this;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ir(Tr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o,s,a,u;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=Rr(t),r=As(n.R)+"/documents",o={documents:e.map((function(t){return Is(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,o)];case 1:return s=i.sent(),a=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){kr(!!e.found),e.found.name,e.found.updateTime;var n=Es(t,e.found.name),r=bs(e.found.updateTime),i=new bi({mapValue:{fields:e.found.fields}});return Ti.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){kr(!!e.missing),kr(!!e.readTime);var n=Es(t,e.missing),r=bs(e.readTime);return Ti.newNoDocument(n,r)}(t,e):Cr()}(n.R,t);a.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());kr(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Vo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e=this;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ii.fromPath(n);e.mutations.push(new Uo(r,e.precondition(r)))})),[4,function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=Rr(t),r=As(n.R)+"/documents",o={writes:e.map((function(t){return ks(n.R,t)}))},[4,n.Ni("Commit",r,o)];case 1:return i.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Cr();e=Vr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ir(Tr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Eo.updateTime(e):Eo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Vr.min()))throw new Ir(Tr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Eo.updateTime(e)}return Eo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),al=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Sc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return(0,i.mG)(t,void 0,void 0,(function(){var t,e,n=this;return(0,i.Jh)(this,(function(r){return t=new sl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!ei(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!jo(e)}return!1},t}(),ul=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=sc.UNAUTHENTICATED,this.clientId=Or.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return(0,i.mG)(r,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return Sr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Ir(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ya;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return(0,i.mG)(t,void 0,void 0,(function(){var t,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ih(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function cl(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r,o=this;return(0,i.Jh)(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Sr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=s.sent(),[4,e.initialize(n)];case 2:return s.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return(0,i.mG)(o,void 0,void 0,(function(){return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Mu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function hl(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ll(t)];case 1:return n=o.sent(),Sr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=o.sent(),[4,e.initialize(n,r)];case 3:return o.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return(0,i.mG)(this,void 0,void 0,(function(){var n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(n=Rr(t)).asyncQueue.verifyOperationInProgress(),Sr("RemoteStore","RemoteStore received new credentials"),r=qc(n),n.Or.add(3),[4,Oc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,xc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function ll(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Sr("FirestoreClient","Using default OfflineComponentProvider"),[4,cl(t,new el)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function fl(t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Sr("FirestoreClient","Using default OnlineComponentProvider"),[4,hl(t,new il)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function pl(t){return ll(t).then((function(t){return t.persistence}))}function dl(t){return ll(t).then((function(t){return t.localStore}))}function yl(t){return fl(t).then((function(t){return t.remoteStore}))}function vl(t){return fl(t).then((function(t){return t.syncEngine}))}function gl(t){return(0,i.mG)(this,void 0,void 0,(function(){var e,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return[4,fl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=_h.bind(null,e.syncEngine),n.onUnlisten=Ah.bind(null,e.syncEngine),n)]}}))}))}function ml(t,e,n){var r=this;void 0===n&&(n={});var o=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(r,void 0,void 0,(function(){var r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new ol({next:function(o){e.enqueueAndForget((function(){return lh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Ir(Tr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Ir(Tr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new yh(Ki(n.path),o,{includeMetadataChanges:!0,so:!0});return hh(t,s)},[4,gl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,o])]}}))}))})),o.promise}function bl(t,e,n){var r=this;void 0===n&&(n={});var o=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(r,void 0,void 0,(function(){var r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new ol({next:function(n){e.enqueueAndForget((function(){return lh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Ir(Tr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new yh(n,o,{includeMetadataChanges:!0,so:!0});return hh(t,s)},[4,gl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,o])]}}))}))})),o.promise}var wl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Tl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Il=new Map,El=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},_l=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(sc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Sl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Al=function(){function t(t){var e=this;this.currentUser=sc.UNAUTHENTICATED,this.oc=new ya,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){Sr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Sr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Sr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(kr("string"==typeof n.accessToken),new El(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return(0,i.mG)(n,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return kr(null===t||"string"==typeof t),new sc(t)},t}(),Nl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=sc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Dl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Nl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(sc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Cl(t,e,n){if(!n)throw new Ir(Tr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function kl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Rl(t,e,n,r){if(!0===e&&!0===r)throw new Ir(Tr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function xl(t){if(!ii.isDocumentKey(t))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Ol(t){if(ii.isDocumentKey(t))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ll(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Cr()}function Pl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ir(Tr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ll(t);throw new Ir(Tr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Ml(t,e){if(e<=0)throw new Ir(Tr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Fl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ir(Tr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ir(Tr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Rl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Vl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fl({}),this._settingsFrozen=!1,t instanceof Tl?(this._databaseId=t,this._credentials=new _l):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ir(Tr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tl(t.options.projectId)}(t),this._credentials=new Al(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Ir(Tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Ir(Tr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new _l;switch(t.type){case"gapi":var e=t.client;return kr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Dl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Ir(Tr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Il.get(this))&&(Sr("ComponentProvider","Removing Datastore"),Il.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ul=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new jl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ql=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),jl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Ki(r))||this)._path=r,i.type="collection",i}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ul(this.firestore,null,new ii(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ql);function Bl(t,e){for(var n,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(t=(0,o.m9)(t),Cl("collection","path",e),t instanceof Vl)return Ol(n=Gr.fromString.apply(Gr,(0,i.ev)([e],r))),new jl(t,null,n);if(!(t instanceof Ul||t instanceof jl))throw new Ir(Tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ol(n=Gr.fromString.apply(Gr,(0,i.ev)([t.path],r)).child(Gr.fromString(e))),new jl(t.firestore,null,n)}function Gl(t,e){for(var n,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(t=(0,o.m9)(t),1===arguments.length&&(e=Or.u()),Cl("doc","path",e),t instanceof Vl)return xl(n=Gr.fromString.apply(Gr,(0,i.ev)([e],r))),new Ul(t,null,new ii(n));if(!(t instanceof Ul||t instanceof jl))throw new Ir(Tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xl(n=t._path.child(Gr.fromString.apply(Gr,(0,i.ev)([e],r)))),new Ul(t.firestore,t instanceof jl?t.converter:null,new ii(n))}function Kl(t,e){return t=(0,o.m9)(t),e=(0,o.m9)(e),(t instanceof Ul||t instanceof jl)&&(e instanceof Ul||e instanceof jl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function zl(t,e){return t=(0,o.m9)(t),e=(0,o.m9)(e),t instanceof ql&&e instanceof ql&&t.firestore===e.firestore&&$i(t._query,e._query)&&t.converter===e.converter}var Hl=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Sc(this,"async_queue_retry"),this.Ic=function(){var e=Ec();e&&Sr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Ec();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=Ec();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new ya;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t,e=this;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Ta(t=n.sent()))throw t;return Sr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,Ar("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=rh.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Cr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Jl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ya,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Ql=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Hl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,i.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Yl(this),this._firestoreClient.terminate()},e}(Vl);function Wl(t){return t._firestoreClient||Yl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Yl(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new wl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ul(t._credentials,t._queue,r)}function Zl(t,e,n){var r=this,o=new ya;return t.asyncQueue.enqueue((function(){return(0,i.mG)(r,void 0,void 0,(function(){var r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,cl(t,n)];case 1:return i.sent(),[4,hl(t,e)];case 2:return i.sent(),o.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Tr.FAILED_PRECONDITION||t.code===Tr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=i.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),o.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return o.promise}))}function Xl(t){if(t._initialized||t._terminated)throw new Ir(Tr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var $l=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),tf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Jr.fromBase64String(e))}catch(e){throw new Ir(Tr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Jr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),ef=function(t){this._methodName=t},nf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ir(Tr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ir(Tr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Lr(this._lat,t._lat)||Lr(this._long,t._long)},t}(),rf=/^__.*__$/,of=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new xo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ro(t,this.data,e,this.fieldTransforms)},t}(),sf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new xo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function af(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Cr()}}var uf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return Df(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(af(this.Nc)&&rf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),cf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||_c(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new uf({Nc:t,methodName:e,qc:n,path:zr.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function hf(t){var e=t._freezeSettings(),n=_c(t._databaseId);return new cf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);_f("Data must be an object, but it was:",s,r);var a,u,c=If(r,s);if(o.merge)a=new Hr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=Sf(e,f[l],n);if(!s.contains(p))throw new Ir(Tr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Cf(h,p)||h.push(p)}a=new Hr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new of(new bi(c),a,u)}var ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ef);function pf(t,e,n){return new uf({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var df=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new To(t.path,new fo)},e.prototype.isEqual=function(t){return t instanceof e},e}(ef),yf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,i.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=pf(this,t,!0),n=this.Kc.map((function(t){return Tf(t,e)})),r=new po(n);return new To(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ef),vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,i.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=pf(this,t,!0),n=this.Kc.map((function(t){return Tf(t,e)})),r=new vo(n);return new To(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ef),gf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,i.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new mo(t.R,ao(t.R,this.Qc));return new To(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ef);function mf(t,e,n,r){var i=t.Uc(1,e,n);_f("Data must be an object, but it was:",i,r);var s=[],a=bi.empty();qr(r,(function(t,r){var u=Nf(e,t,n);r=(0,o.m9)(r);var c=i.Oc(u);if(r instanceof ff)s.push(u);else{var h=Tf(r,c);null!=h&&(s.push(u),a.set(u,h))}}));var u=new Hr(s);return new sf(a,u,i.fieldTransforms)}function bf(t,e,n,r,i,s){var a=t.Uc(1,e,n),u=[Sf(e,r,n)],c=[i];if(s.length%2!=0)throw new Ir(Tr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<s.length;h+=2)u.push(Sf(e,s[h])),c.push(s[h+1]);for(var l=[],f=bi.empty(),p=u.length-1;p>=0;--p)if(!Cf(l,u[p])){var d=u[p],y=c[p];y=(0,o.m9)(y);var v=a.Oc(d);if(y instanceof ff)l.push(d);else{var g=Tf(y,v);null!=g&&(l.push(d),f.set(d,g))}}var m=new Hr(l);return new sf(f,m,a.fieldTransforms)}function wf(t,e,n,r){return void 0===r&&(r=!1),Tf(n,t.Uc(r?4:3,e))}function Tf(t,e){if(Ef(t=(0,o.m9)(t)))return _f("Unsupported field value:",e,t),If(t,e);if(t instanceof ef)return function(t,e){if(!af(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Tf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,o.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ao(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Fr.fromDate(t);return{timestampValue:vs(e.R,n)}}if(t instanceof Fr)return n=new Fr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:vs(e.R,n)};if(t instanceof nf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof tf)return{bytesValue:gs(e.R,t._byteString)};if(t instanceof Ul){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ws(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Ll(t))}(t,e)}function If(t,e){var n={};return jr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qr(t,(function(t,r){var i=Tf(r,e.Fc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ef(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Fr||t instanceof nf||t instanceof tf||t instanceof Ul||t instanceof ef)}function _f(t,e,n){if(!Ef(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ll(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function Sf(t,e,n){if((e=(0,o.m9)(e))instanceof $l)return e._internalPath;if("string"==typeof e)return Nf(t,e);throw Df("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Af=new RegExp("[~\\*/\\[\\]]");function Nf(t,e,n){if(e.search(Af)>=0)throw Df("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new($l.bind.apply($l,(0,i.ev)([void 0],e.split(".")))))._internalPath}catch(r){throw Df("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Df(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Ir(Tr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Cf(t,e){return t.some((function(t){return t.isEqual(e)}))}var kf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ul(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Rf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(xf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Rf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(kf);function xf(t,e){return"string"==typeof e?Nf(t,e):e instanceof $l?e._internalPath:e._delegate._internalPath}var Of=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Lf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,i.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Pf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(xf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(kf),Pf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Lf),Mf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Of(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Pf(n._firestore,n._userDataWriter,r.key,r,new Of(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ir(Tr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new Pf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Of(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Pf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Of(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Ff(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Ff(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Cr()}}function Vf(t,e){return t instanceof Lf&&e instanceof Lf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Mf&&e instanceof Mf&&t._firestore===e._firestore&&zl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Uf(t){if(Hi(t)&&0===t.explicitOrderBy.length)throw new Ir(Tr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var qf=function(){};function jf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Bf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,i.ZT)(e,t),e.prototype._apply=function(t){var e=hf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Wf(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Qf(r,t,l))}a={arrayValue:{values:u}}}else a=Qf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Wf(s,o),a=wf(n,"where",s,"in"===o||"not-in"===o);var f=Ni.create(i,o,a);return function(t,e){if(e.g()){var n=Qi(t);if(null!==n&&!n.isEqual(e.field))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ji(t);null!==r&&Yf(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new ql(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Bi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(qf),Gf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,i.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Vi(e,n);return function(t,e){if(null===Ji(t)){var n=Qi(t);null!==n&&Yf(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new ql(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Bi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(qf),Kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,i.ZT)(e,t),e.prototype._apply=function(t){return new ql(t.firestore,t.converter,Xi(t._query,this.Hc,this.Jc))},e}(qf),zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,i.ZT)(e,t),e.prototype._apply=function(t){var e=Jf(t,this.type,this.Yc,this.Xc);return new ql(t.firestore,t.converter,function(t,e){return new Bi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(qf),Hf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,i.ZT)(e,t),e.prototype._apply=function(t){var e=Jf(t,this.type,this.Yc,this.Xc);return new ql(t.firestore,t.converter,function(t,e){return new Bi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(qf);function Jf(t,e,n,r){if(n[0]=(0,o.m9)(n[0]),n[0]instanceof kf)return function(t,e,n,r,i){if(!r)throw new Ir(Tr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Yi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(fi(e,r.key));else{var c=r.data.field(u.field);if(Xr(c))throw new Ir(Tr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Mi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=hf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Ir(Tr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Wi(t)&&-1!==c.indexOf("/"))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Gr.fromString(c));if(!ii.isDocumentKey(h))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ii(h);a.push(fi(e,l))}else{var f=wf(n,r,c);a.push(f)}}return new Mi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Qf(t,e,n){if("string"==typeof(n=(0,o.m9)(n))){if(""===n)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wi(e)&&-1!==n.indexOf("/"))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Gr.fromString(n));if(!ii.isDocumentKey(r))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return fi(t,new ii(r))}if(n instanceof Ul)return fi(t,n._key);throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ll(n)+".")}function Wf(t,e){if(!Array.isArray(t)||0===t.length)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Yf(t,e,n){if(!n.isEqual(e))throw new Ir(Tr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Zf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),oi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Yr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Zr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Cr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return qr(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new nf(Yr(t.latitude),Yr(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=$r(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ti(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Wr(t);return new Fr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Gr.fromString(t);kr(zs(n));var r=new Tl(n.get(1),n.get(3)),i=new ii(n.popFirst(5));return r.isEqual(e)||Ar("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Xf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var $f=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.ZT)(e,t),e.prototype.convertBytes=function(t){return new tf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ul(this.firestore,null,e)},e}(Zf),tp=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=hf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=ep(t,this._firestore),i=Xf(r.converter,e,n),o=lf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Eo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var s,a=ep(t,this._firestore);return s="string"==typeof(e=(0,o.m9)(e))||e instanceof $l?bf(this._dataReader,"WriteBatch.update",a._key,e,n,r):mf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,Eo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=ep(t,this._firestore);return this._mutations=this._mutations.concat(new Vo(e._key,Eo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Ir(Tr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function ep(t,e){if((t=(0,o.m9)(t)).firestore!==e)throw new Ir(Tr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var np=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.ZT)(e,t),e.prototype.convertBytes=function(t){return new tf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ul(this.firestore,null,e)},e}(Zf);function rp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Pl(t,Ul);var s=Pl(t.firestore,Ql),a=hf(s);return op(s,[("string"==typeof(e=(0,o.m9)(e))||e instanceof $l?bf(a,"updateDoc",t._key,e,n,r):mf(a,"updateDoc",t._key,e)).toMutation(t._key,Eo.exists(!0))])}function ip(t){for(var e,n,r,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=(0,o.m9)(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||Jl(s[c])||(u=s[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(Jl(s[c])){var d=s[c];s[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),s[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),s[c+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Ul)l=Pl(t.firestore,Ql),f=Ki(t._key.path),h={next:function(e){s[c]&&s[c](sp(l,t,e))},error:s[c+1],complete:s[c+2]};else{var y=Pl(t,ql);l=Pl(y.firestore,Ql),f=y._query;var v=new np(l);h={next:function(t){s[c]&&s[c](new Mf(l,v,y,t))},error:s[c+1],complete:s[c+2]},Uf(t._query)}return function(t,e,n,r){var o=this,s=new ol(r),a=new yh(e,s,n);return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(o,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e=hh,[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))})),function(){s.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(o,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e=lh,[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))}))}}(Wl(l),f,p,h)}function op(t,e){return function(t,e){var n=this,r=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var n;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=Nh,[4,vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Wl(t),e)}function sp(t,e,n){var r=n.docs.get(e._key),i=new np(t);return new Lf(t,i,e._key,r,new Of(n.hasPendingWrites,n.fromCache),e.converter)}var ap=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,i.ZT)(e,t),e.prototype.get=function(e){var n=this,r=ep(e,this._firestore),i=new np(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Lf(n._firestore,i,r._key,t._document,new Of(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=hf(t)}return t.prototype.get=function(t){var e=this,n=ep(t,this._firestore),r=new $f(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Cr();var i=t[0];if(i.isFoundDocument())return new kf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new kf(e._firestore,r,n._key,null,n.converter);throw Cr()}))},t.prototype.set=function(t,e,n){var r=ep(t,this._firestore),i=Xf(r.converter,e,n),o=lf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s,a=ep(t,this._firestore);return s="string"==typeof(e=(0,o.m9)(e))||e instanceof $l?bf(this._dataReader,"Transaction.update",a._key,e,n,r):mf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=ep(t,this._firestore);return this._transaction.delete(e._key),this},t}());function up(){if("undefined"==typeof Uint8Array)throw new Ir(Tr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function cp(){if("undefined"==typeof atob)throw new Ir(Tr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var hp=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return cp(),new t(tf.fromBase64String(e))},t.fromUint8Array=function(e){return up(),new t(tf.fromUint8Array(e))},t.prototype.toBase64=function(){return cp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return up(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),lp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Xl(t=Pl(t,Ql));var n=Wl(t),r=t._freezeSettings(),i=new il;return Zl(n,i,new nl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Xl(t=Pl(t,Ql));var e=Wl(t),n=t._freezeSettings(),r=new il;return Zl(e,r,new rl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Ir(Tr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ya;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return(0,i.mG)(e,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return ma.yt()?(e=t+"main",[4,ma.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Cu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),fp=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Tl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Nr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Pl(t,Vl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Nr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s=(0,o.Sg)(r.mockUserToken),a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new Ir(Tr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Sl(new El(s,new sc(a)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,i.mG)(e,void 0,void 0,(function(){var e,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return[4,pl(t)];case 1:return e=r.sent(),[4,yl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Rr(t);return e.Or.delete(0),xc(e)}(n))]}}))}))}))}(Wl(Pl(this._delegate,Ql)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,i.mG)(e,void 0,void 0,(function(){var e,n;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return[4,pl(t)];case 1:return e=r.sent(),[4,yl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,i.mG)(this,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return(e=Rr(t)).Or.add(0),[4,Oc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Wl(Pl(this._delegate,Ql)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Rl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(e,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return e=Oh,[4,vl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Wl(Pl(this._delegate,Ql)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new ol(e);return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Rr(t).Gr.add(e),e.next()},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Rr(t).Gr.delete(e)},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Wl(t=Pl(t,Ql)),Jl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new Ir(Tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ap(this,Bl(this._delegate,t))}catch(t){throw mp(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new gp(this,Gl(this._delegate,t))}catch(t){throw mp(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Ep(this,function(t,e){if(t=Pl(t,Vl),Cl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ql(t,null,function(t){return new Bi(Gr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw mp(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var n;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,function(t){return fl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new al(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Wl(t),(function(n){return e(new ap(t,n))}))}(this._delegate,(function(n){return t(new dp(e,n))}))},t.prototype.batch=function(){var t=this;return Wl(this._delegate),new yp(new tp(this._delegate,(function(e){return op(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new Ir(Tr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Ir(Tr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),pp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.ZT)(e,t),e.prototype.convertBytes=function(t){return new hp(new tf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return gp.eu(e,this.firestore,null)},e}(Zf),dp=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new pp(t)}return t.prototype.get=function(t){var e=this,n=Np(t);return this._delegate.get(n).then((function(t){return new Tp(e._firestore,new Lf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Np(t);return n?(kl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Np(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,(0,i.ev)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Np(t);return this._delegate.delete(e),this},t}(),yp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Np(t);return n?(kl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Np(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,(0,i.ev)([a,e,n],o)),this},t.prototype.delete=function(t){var e=Np(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),vp=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Pf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ip(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new pp(e),n),i.set(n,o)),o},t}();vp.su=new WeakMap;var gp=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new pp(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new Ir(Tr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Ul(n._delegate,r,new ii(e)))},t.eu=function(e,n,r){return new t(n,new Ul(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ap(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Ap(this.firestore,Bl(this._delegate,t))}catch(t){throw mp(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,o.m9)(t))instanceof Ul&&Kl(this._delegate,t)},t.prototype.set=function(t,e){e=kl("DocumentReference.set",e);try{return function(t,e,n){t=Pl(t,Ul);var r=Pl(t.firestore,Ql),i=Xf(t.converter,e,n);return op(r,[lf(hf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Eo.none())])}(this._delegate,t,e)}catch(t){throw mp(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?rp(this._delegate,t):rp.apply(void 0,(0,i.ev)([this._delegate,t,e],n))}catch(t){throw mp(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return op(Pl((t=this._delegate).firestore,Ql),[new Vo(t._key,Eo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=bp(e),i=wp(e,(function(e){return new Tp(t.firestore,new Lf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return ip(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Pl(t,Ul);var e=Pl(t.firestore,Ql),n=Wl(e),r=new np(e);return function(t,e){var n=this,r=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var n;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t,e){var n=Rr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(o=i.sent()).isFoundDocument()?n.resolve(o):o.isNoDocument()?n.resolve(null):n.reject(new Ir(Tr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=ih(r,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}}))}))},[4,dl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Lf(e,r,t._key,n,new Of(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Pl(t,Ul);var e=Pl(t.firestore,Ql);return ml(Wl(e),t._key,{source:"server"}).then((function(n){return sp(e,t,n)}))}(this._delegate):function(t){t=Pl(t,Ul);var e=Pl(t.firestore,Ql);return ml(Wl(e),t._key).then((function(n){return sp(e,t,n)}))}(this._delegate)).then((function(t){return new Tp(e.firestore,new Lf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(vp.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function mp(t,e,n){return t.message=t.message.replace(e,n),t}function bp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Jl(r))return r}return{}}function wp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Jl(t[0])?t[0]:Jl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Tp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new gp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Vf(this._delegate,t._delegate)},t}(),Ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Tp),Ep=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new pp(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,jf(this._delegate,function(t,e,n){var r=e,i=xf("where",t);return new Bf(i,r,n)}(e,n,r)))}catch(e){throw mp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,jf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=xf("orderBy",t);return new Gf(r,n)}(e,n)))}catch(e){throw mp(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,jf(this._delegate,function(t){return Ml("limit",t),new Kf("limit",t,"F")}(e)))}catch(e){throw mp(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,jf(this._delegate,function(t){return Ml("limitToLast",t),new Kf("limitToLast",t,"L")}(e)))}catch(e){throw mp(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new zf("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw mp(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new zf("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw mp(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw mp(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,jf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw mp(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return zl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Pl(t,ql);var e=Pl(t.firestore,Ql),n=Wl(e),r=new np(e);return function(t,e){var n=this,r=new ya;return t.asyncQueue.enqueueAndForget((function(){return(0,i.mG)(n,void 0,void 0,(function(){var n;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,i.mG)(this,void 0,void 0,(function(){var r,o,s,a,u;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Ku(t,e,!0)];case 1:return u=i.sent(),r=new wh(e,u.Bn),o=r._o(u.documents),s=r.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=ih(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,dl(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Mf(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Pl(t,ql);var e=Pl(t.firestore,Ql),n=Wl(e),r=new np(e);return bl(n,t._query,{source:"server"}).then((function(n){return new Mf(e,r,t,n)}))}(this._delegate):function(t){t=Pl(t,ql);var e=Pl(t.firestore,Ql),n=Wl(e),r=new np(e);return Uf(t._query),bl(n,t._query).then((function(n){return new Mf(e,r,t,n)}))}(this._delegate)).then((function(t){return new Sp(e.firestore,new Mf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=bp(e),i=wp(e,(function(e){return new Sp(t.firestore,new Mf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return ip(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(vp.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),_p=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ip(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Sp=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Ep(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Ip(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new _p(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Ip(n._firestore,r))}))},t.prototype.isEqual=function(t){return Vf(this._delegate,t._delegate)},t}(),Ap=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new gp(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new gp(this.firestore,void 0===t?Gl(this._delegate):Gl(this._delegate,t))}catch(t){throw mp(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Pl(t.firestore,Ql),r=Gl(t),i=Xf(t.converter,e);return op(n,[lf(hf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Eo.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new gp(e.firestore,t)}))},e.prototype.isEqual=function(t){return Kl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(vp.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(Ep);function Np(t){return Pl(t,Ul)}var Dp,Cp=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new($l.bind.apply($l,(0,i.ev)([void 0],t)))}return t.documentId=function(){return new t(zr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,o.m9)(t))instanceof $l&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),kp=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new df("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new ff("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vf("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new gf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Rp=n(909),xp={Firestore:fp,GeoPoint:nf,Timestamp:Fr,Blob:hp,Transaction:dp,WriteBatch:yp,DocumentReference:gp,DocumentSnapshot:Tp,Query:Ep,QueryDocumentSnapshot:Ip,QuerySnapshot:Sp,CollectionReference:Ap,FieldPath:Cp,FieldValue:kp,setLogLevel:function(t){var e;e=t,Er.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Rp.wA("firestore",(function(t){return function(t,e){return new fp(t,new Ql(t,e),new lp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},xp)))})(Dp=r.Z),Dp.registerVersion("@firebase/firestore","2.3.9")},655:(t,e,n)=>{"use strict";n.d(e,{ZT:()=>i,pi:()=>o,mG:()=>s,Jh:()=>a,XA:()=>u,CR:()=>c,ev:()=>h});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function u(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function h(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||e)}Object.create,Object.create}}]);